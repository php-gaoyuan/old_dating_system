function LqEvents(){this.events={}}function drag(a){var h,b=a.event,c=a.target,d=a.start||$.noop,e=a.stop||$.noop,f=a.move||$.noop;c.stop(!0,!0),document.body.setCapture&&document.body.setCapture(!0),window.captureEvents&&window.captureEvents(Event.MOUSEMOVE),h=function(){return function(b){document.body.releaseCapture&&document.body.releaseCapture(),window.releaseEvents&&window.releaseEvents(Event.MOUSEMOVE),$(window).unbind("blur.drag"),$(document).unbind("mousemove.drag mouseup.drag");try{document.selection?document.selection.empty?document.selection.empty():document.selection=null:window.getSelection&&window.getSelection().removeAllRanges()}catch(c){}e(b,a)!==!1&&$("html").css({cursor:"auto"})}}(c),$(window).unbind("blur.drag").bind("blur.drag",h),$(document).unbind("mouseup.drag").bind("mouseup.drag",h),$(document).unbind("mousemove.drag").bind("mousemove.drag",function(c){var e=null,g=0,h=null,i=null,j=$(window);return e={x:b.clientX,y:b.clientY},h={xMin:e.x+j.scrollLeft()-c.offset().left,xMax:j.width()-c.outerWidth(),yMin:e.y+j.scrollTop()-c.offset().top,yMax:j.height()-c.outerHeight()},h.xMax+=h.xMin,h.yMax+=h.yMin,i={"margin-top":parseFloat(c.css("margin-top"))||0,"margin-left":parseFloat(c.css("margin-left"))||0},a.range=h,d(b,a,e)!==!1&&$("html").css({cursor:"move"}),function(b){var j,k,d=(new Date).getTime();return 8>d-g?!1:(g=d,j={x:b.clientX,y:b.clientY},j.x>h.xMax&&(j.x=h.xMax),j.x<h.xMin&&(j.x=h.xMin),j.y>h.yMax&&(j.y=h.yMax),j.y<h.yMin&&(j.y=h.yMin),k={dx:j.x-e.x,dy:j.y-e.y},e={x:j.x,y:j.y},i={"margin-top":k.dy+i["margin-top"],"margin-left":k.dx+i["margin-left"]},f(b,a,e,k)!==!1&&c.css(i),!1)}}(c))}function MsgModel(a){this.socket=null,this.timeout=3e4,$.extend(!0,this,a),this.events={message:[],msgChange:[],stateChange:[],winParamChange:[],noReadChange:[]},this.data={},this._timeOutData={},this._dataIndex={},this._winParam={},this._state={},this.init()}function MsgControl(a){this.model=null,$.extend(!0,this,a),this.view=null,this.receiverName="",this.senderName="",this.noticeDate={state:"",stack:[]},this.panelDate={},this.init()}function FriendsPanel(a,b){this.msgWin=null,this.socket=null,this.stranger=x18n.stranger,$.extend(!0,this,b),this.trees={data:{},oData:[],rData:[],root:null,friends:null,recent:null,online:null,searchRoot:null},this.trees.oData.indexs={},this.miniPanel=null,this.miniTips={},this.jqP=$(a),this.jqDisable=null,this.jqTitle=null,this.init()}function MiniPanel(a,b){$.extend(!0,this,b),this.jqP=$(a),this.tipStack=[],this.state="",this.init()}var SWFUpload,JSON,tools,toolLq,collectGarbage,Face,template,chatBox,ChatWin,ChatPanel,ChatEditor,ImgViewer,Env,openSocket,swfobject=function(){function A(){var a,c,d;if(!t){try{a=i.getElementsByTagName("body")[0].appendChild(Q("span")),a.parentNode.removeChild(a)}catch(b){return}for(t=!0,c=l.length,d=0;c>d;d++)l[d]()}}function B(a){t?a():l[l.length]=a}function C(b){if(typeof h.addEventListener!=a)h.addEventListener("load",b,!1);else if(typeof i.addEventListener!=a)i.addEventListener("load",b,!1);else if(typeof h.attachEvent!=a)R(h,"onload",b);else if("function"==typeof h.onload){var c=h.onload;h.onload=function(){c(),b()}}else h.onload=b}function D(){k?E():F()}function E(){var f,g,c=i.getElementsByTagName("body")[0],d=Q(b);d.setAttribute("type",e),f=c.appendChild(d),f?(g=0,function(){if(typeof f.GetVariable!=a){var b=f.GetVariable("$version");b&&(b=b.split(" ")[1].split(","),y.pv=[parseInt(b[0],10),parseInt(b[1],10),parseInt(b[2],10)])}else if(10>g)return g++,setTimeout(arguments.callee,10),void 0;c.removeChild(d),f=null,F()}()):F()}function F(){var c,d,e,f,g,h,i,j,k,l,n,b=m.length;if(b>0)for(c=0;b>c;c++)if(d=m[c].id,e=m[c].callbackFn,f={success:!1,id:d},y.pv[0]>0){if(g=P(d))if(!S(m[c].swfVersion)||y.wk&&y.wk<312)if(m[c].expressInstall&&H()){for(h={},h.data=m[c].expressInstall,h.width=g.getAttribute("width")||"0",h.height=g.getAttribute("height")||"0",g.getAttribute("class")&&(h.styleclass=g.getAttribute("class")),g.getAttribute("align")&&(h.align=g.getAttribute("align")),i={},j=g.getElementsByTagName("param"),k=j.length,l=0;k>l;l++)"movie"!=j[l].getAttribute("name").toLowerCase()&&(i[j[l].getAttribute("name")]=j[l].getAttribute("value"));I(h,i,d,e)}else J(g),e&&e(f);else U(d,!0),e&&(f.success=!0,f.ref=G(d),e(f))}else U(d,!0),e&&(n=G(d),n&&typeof n.SetVariable!=a&&(f.success=!0,f.ref=n),e(f))}function G(c){var f,d=null,e=P(c);return e&&"OBJECT"==e.nodeName&&(typeof e.SetVariable!=a?d=e:(f=e.getElementsByTagName(b)[0],f&&(d=f))),d}function H(){return!u&&S("6.0.65")&&(y.win||y.mac)&&!(y.wk&&y.wk<312)}function I(b,c,d,e){var g,j,k,l;u=!0,r=e||null,s={success:!1,id:d},g=P(d),g&&("OBJECT"==g.nodeName?(p=K(g),q=null):(p=g,q=d),b.id=f,(typeof b.width==a||!/%$/.test(b.width)&&parseInt(b.width,10)<310)&&(b.width="310"),(typeof b.height==a||!/%$/.test(b.height)&&parseInt(b.height,10)<137)&&(b.height="137"),i.title=i.title.slice(0,47)+" - Flash Player Installation",j=y.ie&&y.win?"ActiveX":"PlugIn",k="MMredirectURL="+h.location.toString().replace(/&/g,"%26")+"&MMplayerType="+j+"&MMdoctitle="+i.title,typeof c.flashvars!=a?c.flashvars+="&"+k:c.flashvars=k,y.ie&&y.win&&4!=g.readyState&&(l=Q("div"),d+="SWFObjectNew",l.setAttribute("id",d),g.parentNode.insertBefore(l,g),g.style.display="none",function(){4==g.readyState?g.parentNode.removeChild(g):setTimeout(arguments.callee,10)}()),L(b,c,d))}function J(a){if(y.ie&&y.win&&4!=a.readyState){var b=Q("div");a.parentNode.insertBefore(b,a),b.parentNode.replaceChild(K(a),b),a.style.display="none",function(){4==a.readyState?a.parentNode.removeChild(a):setTimeout(arguments.callee,10)}()}else a.parentNode.replaceChild(K(a),a)}function K(a){var d,e,f,g,c=Q("div");if(y.win&&y.ie)c.innerHTML=a.innerHTML;else if(d=a.getElementsByTagName(b)[0],d&&(e=d.childNodes))for(f=e.length,g=0;f>g;g++)1==e[g].nodeType&&"PARAM"==e[g].nodeName||8==e[g].nodeType||c.appendChild(e[g].cloneNode(!0));return c}function L(c,d,f){var g,i,j,k,l,m,o,p,h=P(f);if(y.wk&&y.wk<312)return g;if(h)if(typeof c.id==a&&(c.id=f),y.ie&&y.win){i="";for(j in c)c[j]!=Object.prototype[j]&&("data"==j.toLowerCase()?d.movie=c[j]:"styleclass"==j.toLowerCase()?i+=' class="'+c[j]+'"':"classid"!=j.toLowerCase()&&(i+=" "+j+'="'+c[j]+'"'));k="";for(l in d)d[l]!=Object.prototype[l]&&(k+='<param name="'+l+'" value="'+d[l]+'" />');h.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+i+">"+k+"</object>",n[n.length]=c.id,g=P(c.id)}else{m=Q(b),m.setAttribute("type",e);for(o in c)c[o]!=Object.prototype[o]&&("styleclass"==o.toLowerCase()?m.setAttribute("class",c[o]):"classid"!=o.toLowerCase()&&m.setAttribute(o,c[o]));for(p in d)d[p]!=Object.prototype[p]&&"movie"!=p.toLowerCase()&&M(m,p,d[p]);h.parentNode.replaceChild(m,h),g=m}return g}function M(a,b,c){var d=Q("param");d.setAttribute("name",b),d.setAttribute("value",c),a.appendChild(d)}function N(a){var b=P(a);b&&"OBJECT"==b.nodeName&&(y.ie&&y.win?(b.style.display="none",function(){4==b.readyState?O(a):setTimeout(arguments.callee,10)}()):b.parentNode.removeChild(b))}function O(a){var c,b=P(a);if(b){for(c in b)"function"==typeof b[c]&&(b[c]=null);b.parentNode.removeChild(b)}}function P(a){var b=null;try{b=i.getElementById(a)}catch(c){}return b}function Q(a){return i.createElement(a)}function R(a,b,c){a.attachEvent(b,c),o[o.length]=[a,b,c]}function S(a){var b=y.pv,c=a.split(".");return c[0]=parseInt(c[0],10),c[1]=parseInt(c[1],10)||0,c[2]=parseInt(c[2],10)||0,b[0]>c[0]||b[0]==c[0]&&b[1]>c[1]||b[0]==c[0]&&b[1]==c[1]&&b[2]>=c[2]?!0:!1}function T(c,d,e,f){var g,h,j;y.ie&&y.mac||(g=i.getElementsByTagName("head")[0],g&&(h=e&&"string"==typeof e?e:"screen",f&&(v=null,w=null),v&&w==h||(j=Q("style"),j.setAttribute("type","text/css"),j.setAttribute("media",h),v=g.appendChild(j),y.ie&&y.win&&typeof i.styleSheets!=a&&i.styleSheets.length>0&&(v=i.styleSheets[i.styleSheets.length-1]),w=h),y.ie&&y.win?v&&typeof v.addRule==b&&v.addRule(c,d):v&&typeof i.createTextNode!=a&&v.appendChild(i.createTextNode(c+" {"+d+"}"))))}function U(a,b){if(x){var c=b?"visible":"hidden";t&&P(a)?P(a).style.visibility=c:T("#"+a,"visibility:"+c)}}function V(b){var c=/[\\\"<>\.;]/,d=null!=c.exec(b);return d&&typeof encodeURIComponent!=a?encodeURIComponent(b):b}var p,q,r,s,v,w,a="undefined",b="object",c="Shockwave Flash",d="ShockwaveFlash.ShockwaveFlash",e="application/x-shockwave-flash",f="SWFObjectExprInst",g="onreadystatechange",h=window,i=document,j=navigator,k=!1,l=[D],m=[],n=[],o=[],t=!1,u=!1,x=!0,y=function(){var s,f=typeof i.getElementById!=a&&typeof i.getElementsByTagName!=a&&typeof i.createElement!=a,g=j.userAgent.toLowerCase(),l=j.platform.toLowerCase(),m=l?/win/.test(l):/win/.test(g),n=l?/mac/.test(l):/mac/.test(g),o=/webkit/.test(g)?parseFloat(g.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,p=!1,q=[0,0,0],r=null;if(typeof j.plugins!=a&&typeof j.plugins[c]==b)r=j.plugins[c].description,!r||typeof j.mimeTypes!=a&&j.mimeTypes[e]&&!j.mimeTypes[e].enabledPlugin||(k=!0,p=!1,r=r.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),q[0]=parseInt(r.replace(/^(.*)\..*$/,"$1"),10),q[1]=parseInt(r.replace(/^.*\.(.*)\s.*$/,"$1"),10),q[2]=/[a-zA-Z]/.test(r)?parseInt(r.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof h.ActiveXObject!=a)try{s=new ActiveXObject(d),s&&(r=s.GetVariable("$version"),r&&(p=!0,r=r.split(" ")[1].split(","),q=[parseInt(r[0],10),parseInt(r[1],10),parseInt(r[2],10)]))}catch(t){}return{w3:f,pv:q,wk:o,ie:p,win:m,mac:n}}();return function(){y.w3&&((typeof i.readyState!=a&&"complete"==i.readyState||typeof i.readyState==a&&(i.getElementsByTagName("body")[0]||i.body))&&A(),t||(typeof i.addEventListener!=a&&i.addEventListener("DOMContentLoaded",A,!1),y.ie&&y.win&&(i.attachEvent(g,function(){"complete"==i.readyState&&(i.detachEvent(g,arguments.callee),A())}),h==top&&function(){if(!t){try{i.documentElement.doScroll("left")}catch(a){return setTimeout(arguments.callee,0),void 0}A()}}()),y.wk&&function(){return t?void 0:/loaded|complete/.test(i.readyState)?(A(),void 0):(setTimeout(arguments.callee,0),void 0)}(),C(A)))}(),function(){y.ie&&y.win&&window.attachEvent("onunload",function(){var b,c,d,e,f,a=o.length;for(b=0;a>b;b++)o[b][0].detachEvent(o[b][1],o[b][2]);for(c=n.length,d=0;c>d;d++)N(n[d]);for(e in y)y[e]=null;y=null;for(f in swfobject)swfobject[f]=null;swfobject=null})}(),{registerObject:function(a,b,c,d){if(y.w3&&a&&b){var e={};e.id=a,e.swfVersion=b,e.expressInstall=c,e.callbackFn=d,m[m.length]=e,U(a,!1)}else d&&d({success:!1,id:a})},getObjectById:function(a){return y.w3?G(a):void 0},embedSWF:function(c,d,e,f,g,h,i,j,k,l){var m={success:!1,id:d};y.w3&&!(y.wk&&y.wk<312)&&c&&d&&e&&f&&g?(U(d,!1),B(function(){var n,o,p,q,r,s;if(e+="",f+="",n={},k&&typeof k===b)for(o in k)n[o]=k[o];if(n.data=c,n.width=e,n.height=f,p={},j&&typeof j===b)for(q in j)p[q]=j[q];if(i&&typeof i===b)for(r in i)typeof p.flashvars!=a?p.flashvars+="&"+r+"="+i[r]:p.flashvars=r+"="+i[r];if(S(g))s=L(n,p,d),n.id==d&&U(d,!0),m.success=!0,m.ref=s;else{if(h&&H())return n.data=h,I(n,p,d,l),void 0;U(d,!0)}l&&l(m)})):l&&l(m)},switchOffAutoHideShow:function(){x=!1},ua:y,getFlashPlayerVersion:function(){return{major:y.pv[0],minor:y.pv[1],release:y.pv[2]}},hasFlashPlayerVersion:S,createSWF:function(a,b,c){return y.w3?L(a,b,c):void 0},showExpressInstall:function(a,b,c,d){y.w3&&H()&&I(a,b,c,d)},removeSWF:function(a){y.w3&&N(a)},createCSS:function(a,b,c,d){y.w3&&T(a,b,c,d)},addDomLoadEvent:B,addLoadEvent:C,getQueryParamValue:function(a){var c,d,b=i.location.search||i.location.hash;if(b){if(/\?/.test(b)&&(b=b.split("?")[1]),null==a)return V(b);for(c=b.split("&"),d=0;d<c.length;d++)if(c[d].substring(0,c[d].indexOf("="))==a)return V(c[d].substring(c[d].indexOf("=")+1))}return""},expressInstallCallback:function(){if(u){var a=P(f);a&&p&&(a.parentNode.replaceChild(p,a),q&&(U(q,!0),y.ie&&y.win&&(p.style.display="block")),r&&r(s)),u=!1}}}}();swfobject=function(){function A(){var a,c,d;if(!t){try{a=i.getElementsByTagName("body")[0].appendChild(Q("span")),a.parentNode.removeChild(a)}catch(b){return}for(t=!0,c=l.length,d=0;c>d;d++)l[d]()}}function B(a){t?a():l[l.length]=a}function C(b){if(typeof h.addEventListener!=a)h.addEventListener("load",b,!1);else if(typeof i.addEventListener!=a)i.addEventListener("load",b,!1);else if(typeof h.attachEvent!=a)R(h,"onload",b);else if("function"==typeof h.onload){var c=h.onload;h.onload=function(){c(),b()}}else h.onload=b}function D(){k?E():F()}function E(){var f,g,c=i.getElementsByTagName("body")[0],d=Q(b);d.setAttribute("type",e),f=c.appendChild(d),f?(g=0,function(){if(typeof f.GetVariable!=a){var b=f.GetVariable("$version");b&&(b=b.split(" ")[1].split(","),y.pv=[parseInt(b[0],10),parseInt(b[1],10),parseInt(b[2],10)])}else if(10>g)return g++,setTimeout(arguments.callee,10),void 0;c.removeChild(d),f=null,F()}()):F()}function F(){var c,d,e,f,g,h,i,j,k,l,n,b=m.length;if(b>0)for(c=0;b>c;c++)if(d=m[c].id,e=m[c].callbackFn,f={success:!1,id:d},y.pv[0]>0){if(g=P(d))if(!S(m[c].swfVersion)||y.wk&&y.wk<312)if(m[c].expressInstall&&H()){for(h={},h.data=m[c].expressInstall,h.width=g.getAttribute("width")||"0",h.height=g.getAttribute("height")||"0",g.getAttribute("class")&&(h.styleclass=g.getAttribute("class")),g.getAttribute("align")&&(h.align=g.getAttribute("align")),i={},j=g.getElementsByTagName("param"),k=j.length,l=0;k>l;l++)"movie"!=j[l].getAttribute("name").toLowerCase()&&(i[j[l].getAttribute("name")]=j[l].getAttribute("value"));I(h,i,d,e)}else J(g),e&&e(f);else U(d,!0),e&&(f.success=!0,f.ref=G(d),e(f))}else U(d,!0),e&&(n=G(d),n&&typeof n.SetVariable!=a&&(f.success=!0,f.ref=n),e(f))}function G(c){var f,d=null,e=P(c);return e&&"OBJECT"==e.nodeName&&(typeof e.SetVariable!=a?d=e:(f=e.getElementsByTagName(b)[0],f&&(d=f))),d}function H(){return!u&&S("6.0.65")&&(y.win||y.mac)&&!(y.wk&&y.wk<312)}function I(b,c,d,e){var g,j,k,l;u=!0,r=e||null,s={success:!1,id:d},g=P(d),g&&("OBJECT"==g.nodeName?(p=K(g),q=null):(p=g,q=d),b.id=f,(typeof b.width==a||!/%$/.test(b.width)&&parseInt(b.width,10)<310)&&(b.width="310"),(typeof b.height==a||!/%$/.test(b.height)&&parseInt(b.height,10)<137)&&(b.height="137"),i.title=i.title.slice(0,47)+" - Flash Player Installation",j=y.ie&&y.win?"ActiveX":"PlugIn",k="MMredirectURL="+h.location.toString().replace(/&/g,"%26")+"&MMplayerType="+j+"&MMdoctitle="+i.title,typeof c.flashvars!=a?c.flashvars+="&"+k:c.flashvars=k,y.ie&&y.win&&4!=g.readyState&&(l=Q("div"),d+="SWFObjectNew",l.setAttribute("id",d),g.parentNode.insertBefore(l,g),g.style.display="none",function(){4==g.readyState?g.parentNode.removeChild(g):setTimeout(arguments.callee,10)}()),L(b,c,d))}function J(a){if(y.ie&&y.win&&4!=a.readyState){var b=Q("div");a.parentNode.insertBefore(b,a),b.parentNode.replaceChild(K(a),b),a.style.display="none",function(){4==a.readyState?a.parentNode.removeChild(a):setTimeout(arguments.callee,10)}()}else a.parentNode.replaceChild(K(a),a)}function K(a){var d,e,f,g,c=Q("div");if(y.win&&y.ie)c.innerHTML=a.innerHTML;else if(d=a.getElementsByTagName(b)[0],d&&(e=d.childNodes))for(f=e.length,g=0;f>g;g++)1==e[g].nodeType&&"PARAM"==e[g].nodeName||8==e[g].nodeType||c.appendChild(e[g].cloneNode(!0));return c}function L(c,d,f){var g,i,j,k,l,m,o,p,h=P(f);if(y.wk&&y.wk<312)return g;if(h)if(typeof c.id==a&&(c.id=f),y.ie&&y.win){i="";for(j in c)c[j]!=Object.prototype[j]&&("data"==j.toLowerCase()?d.movie=c[j]:"styleclass"==j.toLowerCase()?i+=' class="'+c[j]+'"':"classid"!=j.toLowerCase()&&(i+=" "+j+'="'+c[j]+'"'));k="";for(l in d)d[l]!=Object.prototype[l]&&(k+='<param name="'+l+'" value="'+d[l]+'" />');h.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+i+">"+k+"</object>",n[n.length]=c.id,g=P(c.id)}else{m=Q(b),m.setAttribute("type",e);for(o in c)c[o]!=Object.prototype[o]&&("styleclass"==o.toLowerCase()?m.setAttribute("class",c[o]):"classid"!=o.toLowerCase()&&m.setAttribute(o,c[o]));for(p in d)d[p]!=Object.prototype[p]&&"movie"!=p.toLowerCase()&&M(m,p,d[p]);h.parentNode.replaceChild(m,h),g=m}return g}function M(a,b,c){var d=Q("param");d.setAttribute("name",b),d.setAttribute("value",c),a.appendChild(d)}function N(a){var b=P(a);b&&"OBJECT"==b.nodeName&&(y.ie&&y.win?(b.style.display="none",function(){4==b.readyState?O(a):setTimeout(arguments.callee,10)}()):b.parentNode.removeChild(b))}function O(a){var c,b=P(a);if(b){for(c in b)"function"==typeof b[c]&&(b[c]=null);b.parentNode.removeChild(b)}}function P(a){var b=null;try{b=i.getElementById(a)}catch(c){}return b}function Q(a){return i.createElement(a)}function R(a,b,c){a.attachEvent(b,c),o[o.length]=[a,b,c]}function S(a){var b=y.pv,c=a.split(".");return c[0]=parseInt(c[0],10),c[1]=parseInt(c[1],10)||0,c[2]=parseInt(c[2],10)||0,b[0]>c[0]||b[0]==c[0]&&b[1]>c[1]||b[0]==c[0]&&b[1]==c[1]&&b[2]>=c[2]?!0:!1}function T(c,d,e,f){var g,h,j;y.ie&&y.mac||(g=i.getElementsByTagName("head")[0],g&&(h=e&&"string"==typeof e?e:"screen",f&&(v=null,w=null),v&&w==h||(j=Q("style"),j.setAttribute("type","text/css"),j.setAttribute("media",h),v=g.appendChild(j),y.ie&&y.win&&typeof i.styleSheets!=a&&i.styleSheets.length>0&&(v=i.styleSheets[i.styleSheets.length-1]),w=h),y.ie&&y.win?v&&typeof v.addRule==b&&v.addRule(c,d):v&&typeof i.createTextNode!=a&&v.appendChild(i.createTextNode(c+" {"+d+"}"))))}function U(a,b){if(x){var c=b?"visible":"hidden";t&&P(a)?P(a).style.visibility=c:T("#"+a,"visibility:"+c)}}function V(b){var c=/[\\\"<>\.;]/,d=null!=c.exec(b);return d&&typeof encodeURIComponent!=a?encodeURIComponent(b):b}var p,q,r,s,v,w,a="undefined",b="object",c="Shockwave Flash",d="ShockwaveFlash.ShockwaveFlash",e="application/x-shockwave-flash",f="SWFObjectExprInst",g="onreadystatechange",h=window,i=document,j=navigator,k=!1,l=[D],m=[],n=[],o=[],t=!1,u=!1,x=!0,y=function(){var s,f=typeof i.getElementById!=a&&typeof i.getElementsByTagName!=a&&typeof i.createElement!=a,g=j.userAgent.toLowerCase(),l=j.platform.toLowerCase(),m=l?/win/.test(l):/win/.test(g),n=l?/mac/.test(l):/mac/.test(g),o=/webkit/.test(g)?parseFloat(g.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,p=!1,q=[0,0,0],r=null;if(typeof j.plugins!=a&&typeof j.plugins[c]==b)r=j.plugins[c].description,!r||typeof j.mimeTypes!=a&&j.mimeTypes[e]&&!j.mimeTypes[e].enabledPlugin||(k=!0,p=!1,r=r.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),q[0]=parseInt(r.replace(/^(.*)\..*$/,"$1"),10),q[1]=parseInt(r.replace(/^.*\.(.*)\s.*$/,"$1"),10),q[2]=/[a-zA-Z]/.test(r)?parseInt(r.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof h.ActiveXObject!=a)try{s=new ActiveXObject(d),s&&(r=s.GetVariable("$version"),r&&(p=!0,r=r.split(" ")[1].split(","),q=[parseInt(r[0],10),parseInt(r[1],10),parseInt(r[2],10)]))}catch(t){}return{w3:f,pv:q,wk:o,ie:p,win:m,mac:n}}();return function(){y.w3&&((typeof i.readyState!=a&&"complete"==i.readyState||typeof i.readyState==a&&(i.getElementsByTagName("body")[0]||i.body))&&A(),t||(typeof i.addEventListener!=a&&i.addEventListener("DOMContentLoaded",A,!1),y.ie&&y.win&&(i.attachEvent(g,function(){"complete"==i.readyState&&(i.detachEvent(g,arguments.callee),A())}),h==top&&function(){if(!t){try{i.documentElement.doScroll("left")}catch(a){return setTimeout(arguments.callee,0),void 0}A()}}()),y.wk&&function(){return t?void 0:/loaded|complete/.test(i.readyState)?(A(),void 0):(setTimeout(arguments.callee,0),void 0)}(),C(A)))}(),function(){y.ie&&y.win&&window.attachEvent("onunload",function(){var b,c,d,e,f,a=o.length;for(b=0;a>b;b++)o[b][0].detachEvent(o[b][1],o[b][2]);for(c=n.length,d=0;c>d;d++)N(n[d]);for(e in y)y[e]=null;y=null;for(f in swfobject)swfobject[f]=null;swfobject=null})}(),{registerObject:function(a,b,c,d){if(y.w3&&a&&b){var e={};e.id=a,e.swfVersion=b,e.expressInstall=c,e.callbackFn=d,m[m.length]=e,U(a,!1)}else d&&d({success:!1,id:a})},getObjectById:function(a){return y.w3?G(a):void 0},embedSWF:function(c,d,e,f,g,h,i,j,k,l){var m={success:!1,id:d};y.w3&&!(y.wk&&y.wk<312)&&c&&d&&e&&f&&g?(U(d,!1),B(function(){var n,o,p,q,r,s;if(e+="",f+="",n={},k&&typeof k===b)for(o in k)n[o]=k[o];if(n.data=c,n.width=e,n.height=f,p={},j&&typeof j===b)for(q in j)p[q]=j[q];if(i&&typeof i===b)for(r in i)typeof p.flashvars!=a?p.flashvars+="&"+r+"="+i[r]:p.flashvars=r+"="+i[r];if(S(g))s=L(n,p,d),n.id==d&&U(d,!0),m.success=!0,m.ref=s;else{if(h&&H())return n.data=h,I(n,p,d,l),void 0;U(d,!0)}l&&l(m)})):l&&l(m)},switchOffAutoHideShow:function(){x=!1},ua:y,getFlashPlayerVersion:function(){return{major:y.pv[0],minor:y.pv[1],release:y.pv[2]}},hasFlashPlayerVersion:S,createSWF:function(a,b,c){return y.w3?L(a,b,c):void 0},showExpressInstall:function(a,b,c,d){y.w3&&H()&&I(a,b,c,d)},removeSWF:function(a){y.w3&&N(a)},createCSS:function(a,b,c,d){y.w3&&T(a,b,c,d)},addDomLoadEvent:B,addLoadEvent:C,getQueryParamValue:function(a){var c,d,b=i.location.search||i.location.hash;if(b){if(/\?/.test(b)&&(b=b.split("?")[1]),null==a)return V(b);for(c=b.split("&"),d=0;d<c.length;d++)if(c[d].substring(0,c[d].indexOf("="))==a)return V(c[d].substring(c[d].indexOf("=")+1))}return""},expressInstallCallback:function(){if(u){var a=P(f);a&&p&&(a.parentNode.replaceChild(p,a),q&&(U(q,!0),y.ie&&y.win&&(p.style.display="block")),r&&r(s)),u=!1}}}}(),void 0==SWFUpload&&(SWFUpload=function(a){this.initSWFUpload(a)}),SWFUpload.prototype.initSWFUpload=function(a){try{this.customSettings={},this.settings=a,this.eventQueue=[],this.movieName="SWFUpload_"+SWFUpload.movieCount++,this.movieElement=null,SWFUpload.instances[this.movieName]=this,this.initSettings(),this.loadFlash(),this.displayDebugInfo()}catch(b){throw delete SWFUpload.instances[this.movieName],b}},SWFUpload.instances={},SWFUpload.movieCount=0,SWFUpload.version="2.2.0 2009-03-25",SWFUpload.QUEUE_ERROR={QUEUE_LIMIT_EXCEEDED:-100,FILE_EXCEEDS_SIZE_LIMIT:-110,ZERO_BYTE_FILE:-120,INVALID_FILETYPE:-130},SWFUpload.UPLOAD_ERROR={HTTP_ERROR:-200,MISSING_UPLOAD_URL:-210,IO_ERROR:-220,SECURITY_ERROR:-230,UPLOAD_LIMIT_EXCEEDED:-240,UPLOAD_FAILED:-250,SPECIFIED_FILE_ID_NOT_FOUND:-260,FILE_VALIDATION_FAILED:-270,FILE_CANCELLED:-280,UPLOAD_STOPPED:-290},SWFUpload.FILE_STATUS={QUEUED:-1,IN_PROGRESS:-2,ERROR:-3,COMPLETE:-4,CANCELLED:-5},SWFUpload.BUTTON_ACTION={SELECT_FILE:-100,SELECT_FILES:-110,START_UPLOAD:-120},SWFUpload.CURSOR={ARROW:-1,HAND:-2},SWFUpload.WINDOW_MODE={WINDOW:"window",TRANSPARENT:"transparent",OPAQUE:"opaque"},SWFUpload.completeURL=function(a){if("string"!=typeof a||a.match(/^https?:\/\//i)||a.match(/^\//))return a;window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"");var c=window.location.pathname.lastIndexOf("/");return path=0>=c?"/":window.location.pathname.substr(0,c)+"/",path+a},SWFUpload.prototype.initSettings=function(){this.ensureDefault=function(a,b){this.settings[a]=void 0==this.settings[a]?b:this.settings[a]},this.ensureDefault("upload_url",""),this.ensureDefault("preserve_relative_urls",!1),this.ensureDefault("file_post_name","Filedata"),this.ensureDefault("post_params",{}),this.ensureDefault("use_query_string",!1),this.ensureDefault("requeue_on_error",!1),this.ensureDefault("http_success",[]),this.ensureDefault("assume_success_timeout",0),this.ensureDefault("file_types","*.*"),this.ensureDefault("file_types_description","All Files"),this.ensureDefault("file_size_limit",0),this.ensureDefault("file_upload_limit",0),this.ensureDefault("file_queue_limit",0),this.ensureDefault("flash_url","swfupload.swf"),this.ensureDefault("prevent_swf_caching",!0),this.ensureDefault("button_image_url",""),this.ensureDefault("button_width",1),this.ensureDefault("button_height",1),this.ensureDefault("button_text",""),this.ensureDefault("button_text_style","color: #000000; font-size: 16pt;"),this.ensureDefault("button_text_top_padding",0),this.ensureDefault("button_text_left_padding",0),this.ensureDefault("button_action",SWFUpload.BUTTON_ACTION.SELECT_FILES),this.ensureDefault("button_disabled",!1),this.ensureDefault("button_placeholder_id",""),this.ensureDefault("button_placeholder",null),this.ensureDefault("button_cursor",SWFUpload.CURSOR.ARROW),this.ensureDefault("button_window_mode",SWFUpload.WINDOW_MODE.WINDOW),this.ensureDefault("debug",!1),this.settings.debug_enabled=this.settings.debug,this.settings.return_upload_start_handler=this.returnUploadStart,this.ensureDefault("swfupload_loaded_handler",null),this.ensureDefault("file_dialog_start_handler",null),this.ensureDefault("file_queued_handler",null),this.ensureDefault("file_queue_error_handler",null),this.ensureDefault("file_dialog_complete_handler",null),this.ensureDefault("upload_start_handler",null),this.ensureDefault("upload_progress_handler",null),this.ensureDefault("upload_error_handler",null),this.ensureDefault("upload_success_handler",null),this.ensureDefault("upload_complete_handler",null),this.ensureDefault("debug_handler",this.debugMessage),this.ensureDefault("custom_settings",{}),this.customSettings=this.settings.custom_settings,this.settings.prevent_swf_caching&&(this.settings.flash_url=this.settings.flash_url+(this.settings.flash_url.indexOf("?")<0?"?":"&")+"preventswfcaching="+(new Date).getTime()),this.settings.preserve_relative_urls||(this.settings.upload_url=SWFUpload.completeURL(this.settings.upload_url),this.settings.button_image_url=SWFUpload.completeURL(this.settings.button_image_url)),delete this.ensureDefault},SWFUpload.prototype.loadFlash=function(){var a,b;if(null!==document.getElementById(this.movieName))throw"ID "+this.movieName+" is already in use. The Flash Object could not be added";if(a=document.getElementById(this.settings.button_placeholder_id)||this.settings.button_placeholder,void 0==a)throw"Could not find the placeholder element: "+this.settings.button_placeholder_id;b=document.createElement("div"),b.innerHTML=this.getFlashHTML(),a.parentNode.replaceChild(b.firstChild,a),void 0==window[this.movieName]&&(window[this.movieName]=this.getMovieElement())},SWFUpload.prototype.getFlashHTML=function(){return['<object id="',this.movieName,'" type="application/x-shockwave-flash" data="',this.settings.flash_url,'" width="',this.settings.button_width,'" height="',this.settings.button_height,'" class="swfupload">','<param name="wmode" value="',this.settings.button_window_mode,'" />','<param name="movie" value="',this.settings.flash_url,'" />','<param name="quality" value="high" />','<param name="menu" value="false" />','<param name="allowScriptAccess" value="always" />','<param name="flashvars" value="'+this.getFlashVars()+'" />',"</object>"].join("")},SWFUpload.prototype.getFlashVars=function(){var a=this.buildParamString(),b=this.settings.http_success.join(",");return["movieName=",encodeURIComponent(this.movieName),"&amp;uploadURL=",encodeURIComponent(this.settings.upload_url),"&amp;useQueryString=",encodeURIComponent(this.settings.use_query_string),"&amp;requeueOnError=",encodeURIComponent(this.settings.requeue_on_error),"&amp;httpSuccess=",encodeURIComponent(b),"&amp;assumeSuccessTimeout=",encodeURIComponent(this.settings.assume_success_timeout),"&amp;params=",encodeURIComponent(a),"&amp;filePostName=",encodeURIComponent(this.settings.file_post_name),"&amp;fileTypes=",encodeURIComponent(this.settings.file_types),"&amp;fileTypesDescription=",encodeURIComponent(this.settings.file_types_description),"&amp;fileSizeLimit=",encodeURIComponent(this.settings.file_size_limit),"&amp;fileUploadLimit=",encodeURIComponent(this.settings.file_upload_limit),"&amp;fileQueueLimit=",encodeURIComponent(this.settings.file_queue_limit),"&amp;debugEnabled=",encodeURIComponent(this.settings.debug_enabled),"&amp;buttonImageURL=",encodeURIComponent(this.settings.button_image_url),"&amp;buttonWidth=",encodeURIComponent(this.settings.button_width),"&amp;buttonHeight=",encodeURIComponent(this.settings.button_height),"&amp;buttonText=",encodeURIComponent(this.settings.button_text),"&amp;buttonTextTopPadding=",encodeURIComponent(this.settings.button_text_top_padding),"&amp;buttonTextLeftPadding=",encodeURIComponent(this.settings.button_text_left_padding),"&amp;buttonTextStyle=",encodeURIComponent(this.settings.button_text_style),"&amp;buttonAction=",encodeURIComponent(this.settings.button_action),"&amp;buttonDisabled=",encodeURIComponent(this.settings.button_disabled),"&amp;buttonCursor=",encodeURIComponent(this.settings.button_cursor)].join("")},SWFUpload.prototype.getMovieElement=function(){if(void 0==this.movieElement&&(this.movieElement=document.getElementById(this.movieName)),null===this.movieElement)throw"Could not find Flash element";return this.movieElement},SWFUpload.prototype.buildParamString=function(){var c,a=this.settings.post_params,b=[];if("object"==typeof a)for(c in a)a.hasOwnProperty(c)&&b.push(encodeURIComponent(c.toString())+"="+encodeURIComponent(a[c].toString()));return b.join("&amp;")},SWFUpload.prototype.destroy=function(){var a,b;try{if(this.cancelUpload(null,!1),a=null,a=this.getMovieElement(),a&&"unknown"==typeof a.CallFunction){for(b in a)try{"function"==typeof a[b]&&(a[b]=null)}catch(c){}try{a.parentNode.removeChild(a)}catch(d){}}return window[this.movieName]=null,SWFUpload.instances[this.movieName]=null,delete SWFUpload.instances[this.movieName],this.movieElement=null,this.settings=null,this.customSettings=null,this.eventQueue=null,this.movieName=null,!0}catch(e){return!1}},SWFUpload.prototype.displayDebugInfo=function(){this.debug(["---SWFUpload Instance Info---\n","Version: ",SWFUpload.version,"\n","Movie Name: ",this.movieName,"\n","Settings:\n","	","upload_url:               ",this.settings.upload_url,"\n","	","flash_url:                ",this.settings.flash_url,"\n","	","use_query_string:         ",this.settings.use_query_string.toString(),"\n","	","requeue_on_error:         ",this.settings.requeue_on_error.toString(),"\n","	","http_success:             ",this.settings.http_success.join(", "),"\n","	","assume_success_timeout:   ",this.settings.assume_success_timeout,"\n","	","file_post_name:           ",this.settings.file_post_name,"\n","	","post_params:              ",this.settings.post_params.toString(),"\n","	","file_types:               ",this.settings.file_types,"\n","	","file_types_description:   ",this.settings.file_types_description,"\n","	","file_size_limit:          ",this.settings.file_size_limit,"\n","	","file_upload_limit:        ",this.settings.file_upload_limit,"\n","	","file_queue_limit:         ",this.settings.file_queue_limit,"\n","	","debug:                    ",this.settings.debug.toString(),"\n","	","prevent_swf_caching:      ",this.settings.prevent_swf_caching.toString(),"\n","	","button_placeholder_id:    ",this.settings.button_placeholder_id.toString(),"\n","	","button_placeholder:       ",this.settings.button_placeholder?"Set":"Not Set","\n","	","button_image_url:         ",this.settings.button_image_url.toString(),"\n","	","button_width:             ",this.settings.button_width.toString(),"\n","	","button_height:            ",this.settings.button_height.toString(),"\n","	","button_text:              ",this.settings.button_text.toString(),"\n","	","button_text_style:        ",this.settings.button_text_style.toString(),"\n","	","button_text_top_padding:  ",this.settings.button_text_top_padding.toString(),"\n","	","button_text_left_padding: ",this.settings.button_text_left_padding.toString(),"\n","	","button_action:            ",this.settings.button_action.toString(),"\n","	","button_disabled:          ",this.settings.button_disabled.toString(),"\n","	","custom_settings:          ",this.settings.custom_settings.toString(),"\n","Event Handlers:\n","	","swfupload_loaded_handler assigned:  ",("function"==typeof this.settings.swfupload_loaded_handler).toString(),"\n","	","file_dialog_start_handler assigned: ",("function"==typeof this.settings.file_dialog_start_handler).toString(),"\n","	","file_queued_handler assigned:       ",("function"==typeof this.settings.file_queued_handler).toString(),"\n","	","file_queue_error_handler assigned:  ",("function"==typeof this.settings.file_queue_error_handler).toString(),"\n","	","upload_start_handler assigned:      ",("function"==typeof this.settings.upload_start_handler).toString(),"\n","	","upload_progress_handler assigned:   ",("function"==typeof this.settings.upload_progress_handler).toString(),"\n","	","upload_error_handler assigned:      ",("function"==typeof this.settings.upload_error_handler).toString(),"\n","	","upload_success_handler assigned:    ",("function"==typeof this.settings.upload_success_handler).toString(),"\n","	","upload_complete_handler assigned:   ",("function"==typeof this.settings.upload_complete_handler).toString(),"\n","	","debug_handler assigned:             ",("function"==typeof this.settings.debug_handler).toString(),"\n"].join(""))
},SWFUpload.prototype.addSetting=function(a,b,c){return this.settings[a]=void 0==b?c:b},SWFUpload.prototype.getSetting=function(a){return void 0!=this.settings[a]?this.settings[a]:""},SWFUpload.prototype.callFlash=function(functionName,argumentArray){var movieElement,returnValue,returnString;argumentArray=argumentArray||[],movieElement=this.getMovieElement();try{returnString=movieElement.CallFunction('<invoke name="'+functionName+'" returntype="javascript">'+__flash__argumentsToXML(argumentArray,0)+"</invoke>"),returnValue=eval(returnString)}catch(ex){throw"Call to "+functionName+" failed"}return void 0!=returnValue&&"object"==typeof returnValue.post&&(returnValue=this.unescapeFilePostParams(returnValue)),returnValue},SWFUpload.prototype.selectFile=function(){this.callFlash("SelectFile")},SWFUpload.prototype.selectFiles=function(){this.callFlash("SelectFiles")},SWFUpload.prototype.startUpload=function(a){this.callFlash("StartUpload",[a])},SWFUpload.prototype.cancelUpload=function(a,b){b!==!1&&(b=!0),this.callFlash("CancelUpload",[a,b])},SWFUpload.prototype.stopUpload=function(){this.callFlash("StopUpload")},SWFUpload.prototype.getStats=function(){return this.callFlash("GetStats")},SWFUpload.prototype.setStats=function(a){this.callFlash("SetStats",[a])},SWFUpload.prototype.getFile=function(a){return"number"==typeof a?this.callFlash("GetFileByIndex",[a]):this.callFlash("GetFile",[a])},SWFUpload.prototype.addFileParam=function(a,b,c){return this.callFlash("AddFileParam",[a,b,c])},SWFUpload.prototype.removeFileParam=function(a,b){this.callFlash("RemoveFileParam",[a,b])},SWFUpload.prototype.setUploadURL=function(a){this.settings.upload_url=a.toString(),this.callFlash("SetUploadURL",[a])},SWFUpload.prototype.setPostParams=function(a){this.settings.post_params=a,this.callFlash("SetPostParams",[a])},SWFUpload.prototype.addPostParam=function(a,b){this.settings.post_params[a]=b,this.callFlash("SetPostParams",[this.settings.post_params])},SWFUpload.prototype.removePostParam=function(a){delete this.settings.post_params[a],this.callFlash("SetPostParams",[this.settings.post_params])},SWFUpload.prototype.setFileTypes=function(a,b){this.settings.file_types=a,this.settings.file_types_description=b,this.callFlash("SetFileTypes",[a,b])},SWFUpload.prototype.setFileSizeLimit=function(a){this.settings.file_size_limit=a,this.callFlash("SetFileSizeLimit",[a])},SWFUpload.prototype.setFileUploadLimit=function(a){this.settings.file_upload_limit=a,this.callFlash("SetFileUploadLimit",[a])},SWFUpload.prototype.setFileQueueLimit=function(a){this.settings.file_queue_limit=a,this.callFlash("SetFileQueueLimit",[a])},SWFUpload.prototype.setFilePostName=function(a){this.settings.file_post_name=a,this.callFlash("SetFilePostName",[a])},SWFUpload.prototype.setUseQueryString=function(a){this.settings.use_query_string=a,this.callFlash("SetUseQueryString",[a])},SWFUpload.prototype.setRequeueOnError=function(a){this.settings.requeue_on_error=a,this.callFlash("SetRequeueOnError",[a])},SWFUpload.prototype.setHTTPSuccess=function(a){"string"==typeof a&&(a=a.replace(" ","").split(",")),this.settings.http_success=a,this.callFlash("SetHTTPSuccess",[a])},SWFUpload.prototype.setAssumeSuccessTimeout=function(a){this.settings.assume_success_timeout=a,this.callFlash("SetAssumeSuccessTimeout",[a])},SWFUpload.prototype.setDebugEnabled=function(a){this.settings.debug_enabled=a,this.callFlash("SetDebugEnabled",[a])},SWFUpload.prototype.setButtonImageURL=function(a){void 0==a&&(a=""),this.settings.button_image_url=a,this.callFlash("SetButtonImageURL",[a])},SWFUpload.prototype.setButtonDimensions=function(a,b){this.settings.button_width=a,this.settings.button_height=b;var c=this.getMovieElement();void 0!=c&&(c.style.width=a+"px",c.style.height=b+"px"),this.callFlash("SetButtonDimensions",[a,b])},SWFUpload.prototype.setButtonText=function(a){this.settings.button_text=a,this.callFlash("SetButtonText",[a])},SWFUpload.prototype.setButtonTextPadding=function(a,b){this.settings.button_text_top_padding=b,this.settings.button_text_left_padding=a,this.callFlash("SetButtonTextPadding",[a,b])},SWFUpload.prototype.setButtonTextStyle=function(a){this.settings.button_text_style=a,this.callFlash("SetButtonTextStyle",[a])},SWFUpload.prototype.setButtonDisabled=function(a){this.settings.button_disabled=a,this.callFlash("SetButtonDisabled",[a])},SWFUpload.prototype.setButtonAction=function(a){this.settings.button_action=a,this.callFlash("SetButtonAction",[a])},SWFUpload.prototype.setButtonCursor=function(a){this.settings.button_cursor=a,this.callFlash("SetButtonCursor",[a])},SWFUpload.prototype.queueEvent=function(a,b){void 0==b?b=[]:b instanceof Array||(b=[b]);var c=this;if("function"==typeof this.settings[a])this.eventQueue.push(function(){this.settings[a].apply(this,b)}),setTimeout(function(){c.executeNextEvent()},0);else if(null!==this.settings[a])throw"Event handler "+a+" is unknown or is not a function"},SWFUpload.prototype.executeNextEvent=function(){var a=this.eventQueue?this.eventQueue.shift():null;"function"==typeof a&&a.apply(this)},SWFUpload.prototype.unescapeFilePostParams=function(a){var d,e,f,b=/[$]([0-9a-f]{4})/i,c={};if(void 0!=a){for(e in a.post)if(a.post.hasOwnProperty(e)){for(d=e;null!==(f=b.exec(d));)d=d.replace(f[0],String.fromCharCode(parseInt("0x"+f[1],16)));c[d]=a.post[e]}a.post=c}return a},SWFUpload.prototype.testExternalInterface=function(){try{return this.callFlash("TestExternalInterface")}catch(a){return!1}},SWFUpload.prototype.flashReady=function(){var a=this.getMovieElement();return a?(this.cleanUp(a),this.queueEvent("swfupload_loaded_handler"),void 0):(this.debug("Flash called back ready but the flash movie can't be found."),void 0)},SWFUpload.prototype.cleanUp=function(a){try{if(this.movieElement&&"unknown"==typeof a.CallFunction){this.debug("Removing Flash functions hooks (this should only run in IE and should prevent memory leaks)");for(var b in a)try{"function"==typeof a[b]&&(a[b]=null)}catch(c){}}}catch(d){}window.__flash__removeCallback=function(a,b){try{a&&(a[b]=null)}catch(c){}}},SWFUpload.prototype.fileDialogStart=function(){this.queueEvent("file_dialog_start_handler")},SWFUpload.prototype.fileQueued=function(a){a=this.unescapeFilePostParams(a),this.queueEvent("file_queued_handler",a)},SWFUpload.prototype.fileQueueError=function(a,b,c){a=this.unescapeFilePostParams(a),this.queueEvent("file_queue_error_handler",[a,b,c])},SWFUpload.prototype.fileDialogComplete=function(a,b,c){this.queueEvent("file_dialog_complete_handler",[a,b,c])},SWFUpload.prototype.uploadStart=function(a){a=this.unescapeFilePostParams(a),this.queueEvent("return_upload_start_handler",a)},SWFUpload.prototype.returnUploadStart=function(a){var b;if("function"==typeof this.settings.upload_start_handler)a=this.unescapeFilePostParams(a),b=this.settings.upload_start_handler.call(this,a);else if(void 0!=this.settings.upload_start_handler)throw"upload_start_handler must be a function";void 0===b&&(b=!0),b=!!b,this.callFlash("ReturnUploadStart",[b])},SWFUpload.prototype.uploadProgress=function(a,b,c){a=this.unescapeFilePostParams(a),this.queueEvent("upload_progress_handler",[a,b,c])},SWFUpload.prototype.uploadError=function(a,b,c){a=this.unescapeFilePostParams(a),this.queueEvent("upload_error_handler",[a,b,c])},SWFUpload.prototype.uploadSuccess=function(a,b,c){a=this.unescapeFilePostParams(a),this.queueEvent("upload_success_handler",[a,b,c])},SWFUpload.prototype.uploadComplete=function(a){a=this.unescapeFilePostParams(a),this.queueEvent("upload_complete_handler",a)},SWFUpload.prototype.debug=function(a){this.queueEvent("debug_handler",a)},SWFUpload.prototype.debugMessage=function(a){var b,c,d;if(this.settings.debug)if(c=[],"object"==typeof a&&"string"==typeof a.name&&"string"==typeof a.message){for(d in a)a.hasOwnProperty(d)&&c.push(d+": "+a[d]);b=c.join("\n")||"",c=b.split("\n"),b="EXCEPTION: "+c.join("\nEXCEPTION: "),SWFUpload.Console.writeLine(b)}else SWFUpload.Console.writeLine(a)},SWFUpload.Console={},SWFUpload.Console.writeLine=function(a){var b,c;try{b=document.getElementById("SWFUpload_Console"),b||(c=document.createElement("form"),document.getElementsByTagName("body")[0].appendChild(c),b=document.createElement("textarea"),b.id="SWFUpload_Console",b.style.fontFamily="monospace",b.setAttribute("wrap","off"),b.wrap="off",b.style.overflow="auto",b.style.width="700px",b.style.height="350px",b.style.margin="5px",c.appendChild(b)),b.value+=a+"\n",b.scrollTop=b.scrollHeight-b.clientHeight}catch(d){alert("Exception: "+d.name+" Message: "+d.message)}},function(a){var b={init:function(b,d){return this.each(function(){var i,j,k,l,m,n,e=a(this),f=e.clone(),g=a.extend({id:e.attr("id"),swf:"uploadify.swf",uploader:"uploadify.php",auto:!0,buttonClass:"",buttonCursor:"hand",buttonImage:null,buttonText:"SELECT FILES",checkExisting:!1,debug:!1,fileObjName:"Filedata",fileSizeLimit:0,fileTypeDesc:"All Files",fileTypeExts:"*.*",height:30,method:"post",multi:!0,formData:{},preventCaching:!0,progressData:"percentage",queueID:!1,queueSizeLimit:999,removeCompleted:!0,removeTimeout:3,requeueErrors:!1,successTimeout:30,uploadLimit:0,width:120,overrideEvents:[]},b),h={assume_success_timeout:g.successTimeout,button_placeholder_id:g.id,button_width:g.width,button_height:g.height,button_text:null,button_text_style:null,button_text_top_padding:0,button_text_left_padding:0,button_action:g.multi?SWFUpload.BUTTON_ACTION.SELECT_FILES:SWFUpload.BUTTON_ACTION.SELECT_FILE,button_disabled:!1,button_cursor:"arrow"==g.buttonCursor?SWFUpload.CURSOR.ARROW:SWFUpload.CURSOR.HAND,button_window_mode:SWFUpload.WINDOW_MODE.TRANSPARENT,debug:g.debug,requeue_on_error:g.requeueErrors,file_post_name:g.fileObjName,file_size_limit:g.fileSizeLimit,file_types:g.fileTypeExts,file_types_description:g.fileTypeDesc,file_queue_limit:g.queueSizeLimit,file_upload_limit:g.uploadLimit,flash_url:g.swf,prevent_swf_caching:g.preventCaching,post_params:g.formData,upload_url:g.uploader,use_query_string:"get"==g.method,file_dialog_complete_handler:c.onDialogClose,file_dialog_start_handler:c.onDialogOpen,file_queued_handler:c.onSelect,file_queue_error_handler:c.onSelectError,swfupload_loaded_handler:g.onSWFReady,upload_complete_handler:c.onUploadComplete,upload_error_handler:c.onUploadError,upload_progress_handler:c.onUploadProgress,upload_start_handler:c.onUploadStart,upload_success_handler:c.onUploadSuccess};d&&(h=a.extend(h,d)),h=a.extend(h,g),i=swfobject.getFlashPlayerVersion(),j=i.major>=9,j?(window["uploadify_"+g.id]=new SWFUpload(h),k=window["uploadify_"+g.id],e.data("uploadify",k),l=a("<div />",{id:g.id,"class":"uploadify",css:{height:g.height+"px",width:g.width+"px"}}),a("#"+k.movieName).wrap(l),l=a("#"+g.id),l.data("uploadify",k),m=a("<div />",{id:g.id+"-button","class":"uploadify-button "+g.buttonClass}),g.buttonImage&&m.css({"background-image":"url('"+g.buttonImage+"')","text-indent":"-9999px"}),m.html('<span class="uploadify-button-text">'+g.buttonText+"</span>").css({height:g.height+"px","line-height":g.height+"px",width:g.width+"px"}),l.append(m),a("#"+k.movieName).css({position:"absolute","z-index":1}),g.queueID||(n=a("<div />",{id:g.id+"-queue","class":"uploadify-queue"}),l.after(n),k.settings.queueID=g.id+"-queue",k.settings.defaultQueue=!0),k.queueData={files:{},filesSelected:0,filesQueued:0,filesReplaced:0,filesCancelled:0,filesErrored:0,uploadsSuccessful:0,uploadsErrored:0,averageSpeed:0,queueLength:0,queueSize:0,uploadSize:0,queueBytesUploaded:0,uploadQueue:[],errorMsg:"Some files were not added to the queue:"},k.original=f,k.wrapper=l,k.button=m,k.queue=n,g.onInit&&g.onInit.call(e,k)):g.onFallback&&g.onFallback.call(e)})},cancel:function(){var d=arguments;this.each(function(){var g,h,i,b=a(this),c=b.data("uploadify"),e=c.settings,f=-1;if(d[0])if("*"==d[0])g=c.queueData.queueLength,a("#"+e.queueID).find(".uploadify-queue-item").each(function(){f++,d[1]===!0?c.cancelUpload(a(this).attr("id"),!1):c.cancelUpload(a(this).attr("id")),a(this).remove()}),c.queueData.queueSize=0,c.queueData.queueLength=0,e.onClearQueue&&e.onClearQueue.call(b,g);else for(h=0;h<d.length;h++)c.cancelUpload(d[h]),a("#"+d[h]).remove(),e.onCancel&&e.onCancel();else i=a("#"+e.queueID).find(".uploadify-queue-item").get(0),$item=a(i),c.cancelUpload($item.attr("id")),$item.find(".data").removeClass("data").html(" - Cancelled"),$item.find(".uploadify-progress-bar").remove(),$item.delay(500).fadeOut(500,function(){a(this).remove()})})},destroy:function(){this.each(function(){var b=a(this),c=b.data("uploadify"),d=c.settings;c.destroy(),d.defaultQueue&&a("#"+d.queueID).remove(),a("#"+d.id).replaceWith(c.original),d.onDestroy&&d.onDestroy.call(this),delete c})},disable:function(b){this.each(function(){var c=a(this),d=c.data("uploadify"),e=d.settings;b?(d.button.addClass("disabled"),e.onDisable&&e.onDisable.call(this)):(d.button.removeClass("disabled"),e.onEnable&&e.onEnable.call(this)),d.setButtonDisabled(b)})},settings:function(b,c,d){var e=arguments,f=c;return this.each(function(){var j,g=a(this),h=g.data("uploadify"),i=h.settings;if("object"==typeof e[0])for(j in c)setData(j,c[j]);if(1===e.length)f=i[b];else{switch(b){case"uploader":h.setUploadURL(c);break;case"formData":d||(c=a.extend(i.formData,c)),h.setPostParams(i.formData);break;case"method":"get"==c?h.setUseQueryString(!0):h.setUseQueryString(!1);break;case"fileObjName":h.setFilePostName(c);break;case"fileTypeExts":h.setFileTypes(c,i.fileTypeDesc);break;case"fileTypeDesc":h.setFileTypes(i.fileTypeExts,c);break;case"fileSizeLimit":h.setFileSizeLimit(c);break;case"uploadLimit":h.setFileUploadLimit(c);break;case"queueSizeLimit":h.setFileQueueLimit(c);break;case"buttonImage":h.button.css("background-image",settingValue);break;case"buttonCursor":"arrow"==c?h.setButtonCursor(SWFUpload.CURSOR.ARROW):h.setButtonCursor(SWFUpload.CURSOR.HAND);break;case"buttonText":a("#"+i.id+"-button").find(".uploadify-button-text").html(c);break;case"width":h.setButtonDimensions(c,i.height);break;case"height":h.setButtonDimensions(i.width,c);break;case"multi":c?h.setButtonAction(SWFUpload.BUTTON_ACTION.SELECT_FILES):h.setButtonAction(SWFUpload.BUTTON_ACTION.SELECT_FILE)}i[b]=c}}),1===e.length?f:void 0},stop:function(){this.each(function(){var b=a(this),c=b.data("uploadify");c.queueData.averageSpeed=0,c.queueData.uploadSize=0,c.queueData.bytesUploaded=0,c.queueData.uploadQueue=[],c.stopUpload()})},upload:function(){var b=arguments;this.each(function(){var e,c=a(this),d=c.data("uploadify");if(d.queueData.averageSpeed=0,d.queueData.uploadSize=0,d.queueData.bytesUploaded=0,d.queueData.uploadQueue=[],b[0])if("*"==b[0])d.queueData.uploadSize=d.queueData.queueSize,d.queueData.uploadQueue.push("*"),d.startUpload();else{for(e=0;e<b.length;e++)d.queueData.uploadSize+=d.queueData.files[b[e]].size,d.queueData.uploadQueue.push(b[e]);d.startUpload(d.queueData.uploadQueue.shift())}else d.startUpload()})}},c={onDialogOpen:function(){var a=this.settings;this.queueData.errorMsg="Some files were not added to the queue:",this.queueData.filesReplaced=0,this.queueData.filesCancelled=0,a.onDialogOpen&&a.onDialogOpen.call(this)},onDialogClose:function(b,c,d){var e=this.settings;this.queueData.filesErrored=b-c,this.queueData.filesSelected=b,this.queueData.filesQueued=c-this.queueData.filesCancelled,this.queueData.queueLength=d,a.inArray("onDialogClose",e.overrideEvents)<0&&this.queueData.filesErrored>0&&alert(this.queueData.errorMsg),e.onDialogClose&&e.onDialogClose.call(this,this.queueData),e.auto&&a("#"+e.id).uploadify("upload","*")},onSelect:function(b){var e,f,g,h,i,j,c=this.settings,d={};for(e in this.queueData.files)if(d=this.queueData.files[e],c.onlyone)1!=d.uploaded&&(a("#"+d.id).remove(),this.cancelUpload(d.id),this.queueData.filesReplaced++);else if(1!=d.uploaded&&d.name==b.name){if(f=confirm('The file named "'+b.name+'" is already in the queue.\nDo you want to replace the existing item in the queue?'),!f)return this.cancelUpload(b.id),this.queueData.filesCancelled++,!1;a("#"+d.id).remove(),this.cancelUpload(d.id),this.queueData.filesReplaced++}g=Math.round(b.size/1024),h="KB",g>1e3&&(g=Math.round(g/1e3),h="MB"),i=g.toString().split("."),g=i[0],i.length>1&&(g+="."+i[1].substr(0,2)),g+=h,j=b.name,j.length>25&&(j=j.substr(0,25)+"..."),a.inArray("onSelect",c.overrideEvents)<0&&a("#"+c.queueID).append('<div id="'+b.id+'" class="uploadify-queue-item">					<div class="cancel">						<a href="javascript:$(\'#'+c.id+"').uploadify('cancel', '"+b.id+'\')"></a>					</div>					<span class="fileName">'+j+')</span><span class="data"></span>					<div class="uploadify-progress">						<div class="uploadify-progress-bar"><!--Progress Bar--></div>					</div>				</div>'),this.queueData.queueSize+=b.size,this.queueData.files[b.id]=b,c.onSelect&&c.onSelect.apply(this,arguments)},onSelectError:function(b,c,d){var e=this.settings;if(a.inArray("onSelectError",e.overrideEvents)<0)switch(c){case SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED:this.queueData.errorMsg+=e.queueSizeLimit>d?"\nThe number of files selected exceeds the remaining upload limit ("+d+").":"\nThe number of files selected exceeds the queue size limit ("+e.queueSizeLimit+").";break;case SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:this.queueData.errorMsg+='\nThe file "'+b.name+'" exceeds the size limit ('+e.fileSizeLimit+").";break;case SWFUpload.QUEUE_ERROR.ZERO_BYTE_FILE:this.queueData.errorMsg+='\nThe file "'+b.name+'" is empty.';break;case SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:this.queueData.errorMsg+='\nThe file "'+b.name+'" is not an accepted file type ('+e.fileTypeDesc+")."}c!=SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED&&delete this.queueData.files[b.id],e.onSelectError&&e.onSelectError.apply(this,arguments)},onQueueComplete:function(){this.settings.onQueueComplete&&this.settings.onQueueComplete.call(this,this.settings.queueData)},onUploadComplete:function(b){var c=this.settings,d=this,e=this.getStats();if(this.queueData.queueLength=e.files_queued,"*"==this.queueData.uploadQueue[0]?this.queueData.queueLength>0?this.startUpload():(this.queueData.uploadQueue=[],c.onQueueComplete&&c.onQueueComplete.call(this,this.queueData)):this.queueData.uploadQueue.length>0?this.startUpload(this.queueData.uploadQueue.shift()):(this.queueData.uploadQueue=[],c.onQueueComplete&&c.onQueueComplete.call(this,this.queueData)),a.inArray("onUploadComplete",c.overrideEvents)<0)if(c.removeCompleted)switch(b.filestatus){case SWFUpload.FILE_STATUS.COMPLETE:setTimeout(function(){a("#"+b.id)&&(d.queueData.queueSize-=b.size,d.queueData.queueLength-=1,delete d.queueData.files[b.id],a("#"+b.id).fadeOut(500,function(){a(this).remove()}))},1e3*c.removeTimeout);break;case SWFUpload.FILE_STATUS.ERROR:c.requeueErrors||setTimeout(function(){a("#"+b.id)&&(d.queueData.queueSize-=b.size,d.queueData.queueLength-=1,delete d.queueData.files[b.id],a("#"+b.id).fadeOut(500,function(){a(this).remove()}))},1e3*c.removeTimeout)}else b.uploaded=!0;c.onUploadComplete&&c.onUploadComplete.call(this,b)},onUploadError:function(b,c,d){var g,e=this.settings,f="Error";switch(c){case SWFUpload.UPLOAD_ERROR.HTTP_ERROR:f="HTTP Error ("+d+")";break;case SWFUpload.UPLOAD_ERROR.MISSING_UPLOAD_URL:f="Missing Upload URL";break;case SWFUpload.UPLOAD_ERROR.IO_ERROR:f="IO Error";break;case SWFUpload.UPLOAD_ERROR.SECURITY_ERROR:f="Security Error";break;case SWFUpload.UPLOAD_ERROR.UPLOAD_LIMIT_EXCEEDED:alert("The upload limit has been reached ("+d+")."),f="Exceeds Upload Limit";break;case SWFUpload.UPLOAD_ERROR.UPLOAD_FAILED:f="Failed";break;case SWFUpload.UPLOAD_ERROR.SPECIFIED_FILE_ID_NOT_FOUND:break;case SWFUpload.UPLOAD_ERROR.FILE_VALIDATION_FAILED:f="Validation Error";break;case SWFUpload.UPLOAD_ERROR.FILE_CANCELLED:f="Cancelled",this.queueData.queueSize-=b.size,this.queueData.queueLength-=1,(b.status==SWFUpload.FILE_STATUS.IN_PROGRESS||a.inArray(b.id,this.queueData.uploadQueue)>=0)&&(this.queueData.uploadSize-=b.size),delete this.queueData.files[b.id];break;case SWFUpload.UPLOAD_ERROR.UPLOAD_STOPPED:f="Stopped"}a.inArray("onUploadError",e.overrideEvents)<0&&(c!=SWFUpload.UPLOAD_ERROR.FILE_CANCELLED&&c!=SWFUpload.UPLOAD_ERROR.UPLOAD_STOPPED&&a("#"+b.id).addClass("uploadify-error"),a("#"+b.id).find(".uploadify-progress-bar").css("width","1px"),c!=SWFUpload.UPLOAD_ERROR.SPECIFIED_FILE_ID_NOT_FOUND&&b.status!=SWFUpload.FILE_STATUS.COMPLETE&&a("#"+b.id).find(".data").html(" - "+f)),g=this.getStats(),this.queueData.uploadsErrored=g.upload_errors,e.onUploadError&&e.onUploadError.call(this,b,c,d,f)},onUploadProgress:function(b,c,d){var i,j,k,l,m,n,e=this.settings,f=new Date,g=f.getTime(),h=g-this.timer;h>500&&(this.timer=g),i=c-this.bytesLoaded,this.bytesLoaded=c,j=this.queueData.queueBytesUploaded+c,k=Math.round(100*(c/d)),l="KB/s",m=0,n=i/1024/(h/1e3),n=Math.floor(10*n)/10,this.queueData.averageSpeed=this.queueData.averageSpeed>0?Math.floor((this.queueData.averageSpeed+n)/2):Math.floor(n),n>1e3&&(m=.001*n,this.queueData.averageSpeed=Math.floor(m),l="MB/s"),a.inArray("onUploadProgress",e.overrideEvents)<0&&("percentage"==e.progressData?a("#"+b.id).find(".data").html(" - "+k+"%"):"speed"==e.progressData&&h>500&&a("#"+b.id).find(".data").html(" - "+this.queueData.averageSpeed+l),a("#"+b.id).find(".uploadify-progress-bar").css("width",k+"%")),e.onUploadProgress&&e.onUploadProgress.call(this,b,c,d,j,this.queueData.uploadSize)},onUploadStart:function(b){var c=this.settings,d=new Date;this.timer=d.getTime(),this.bytesLoaded=0,0==this.queueData.uploadQueue.length&&(this.queueData.uploadSize=b.size),c.checkExisting&&a.ajax({type:"POST",async:!1,url:c.checkExisting,data:{filename:b.name},success:function(c){if(1==c){var d=confirm('A file with the name "'+b.name+'" already exists on the server.\nWould you like to replace the existing file?');d||(this.cancelUpload(b.id),a("#"+b.id).remove(),this.queueData.uploadQueue.length>0&&this.queueData.queueLength>0&&("*"==this.queueData.uploadQueue[0]?this.startUpload():this.startUpload(this.queueData.uploadQueue.shift())))}}}),c.onUploadStart&&c.onUploadStart.call(this,b)},onUploadSuccess:function(b,c,d){var e=this.settings,f=this.getStats();this.queueData.uploadsSuccessful=f.successful_uploads,this.queueData.queueBytesUploaded+=b.size,a.inArray("onUploadSuccess",e.overrideEvents)<0&&a("#"+b.id).find(".data").html(" - Complete"),e.onUploadSuccess&&e.onUploadSuccess.call(this,b,c,d)}};a.fn.uploadify=function(c){return b[c]?b[c].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof c&&c?(a.error("The method "+c+" does not exist in $.uploadify"),void 0):b.init.apply(this,arguments)}}(jQuery),function(){if(window.WEB_SOCKET_FORCE_FLASH);else{if(window.WebSocket)return;if(window.MozWebSocket)return window.WebSocket=MozWebSocket,void 0}var a;return a=window.WEB_SOCKET_LOGGER?WEB_SOCKET_LOGGER:window.console&&window.console.log&&window.console.error?window.console:{log:function(){},error:function(){}},swfobject.getFlashPlayerVersion().major<10?(a.error("Flash Player >= 10.0.0 is required."),void 0):("file:"==location.protocol&&a.error("WARNING: web-socket-js doesn't work in file:///... URL unless you set Flash Security Settings properly. Open the page via Web server i.e. http://..."),window.WebSocket=function(a,b,c,d,e){var f=this;f.__id=WebSocket.__nextId++,WebSocket.__instances[f.__id]=f,f.readyState=WebSocket.CONNECTING,f.bufferedAmount=0,f.__events={},b?"string"==typeof b&&(b=[b]):b=[],f.__createTask=setTimeout(function(){WebSocket.__addTask(function(){f.__createTask=null,WebSocket.__flash.create(f.__id,a,b,c||null,d||0,e||null)})},0)},WebSocket.prototype.send=function(a){if(this.readyState==WebSocket.CONNECTING)throw"INVALID_STATE_ERR: Web Socket connection has not been established";var b=WebSocket.__flash.send(this.__id,encodeURIComponent(a));return 0>b?!0:(this.bufferedAmount+=b,!1)},WebSocket.prototype.close=function(){return this.__createTask?(clearTimeout(this.__createTask),this.__createTask=null,this.readyState=WebSocket.CLOSED,void 0):(this.readyState!=WebSocket.CLOSED&&this.readyState!=WebSocket.CLOSING&&(this.readyState=WebSocket.CLOSING,WebSocket.__flash.close(this.__id)),void 0)},WebSocket.prototype.addEventListener=function(a,b){a in this.__events||(this.__events[a]=[]),this.__events[a].push(b)},WebSocket.prototype.removeEventListener=function(a,b){var d,e;if(a in this.__events)for(d=this.__events[a],e=d.length-1;e>=0;--e)if(d[e]===b){d.splice(e,1);break}},WebSocket.prototype.dispatchEvent=function(a){var c,d,b=this.__events[a.type]||[];for(c=0;c<b.length;++c)b[c](a);d=this["on"+a.type],d&&d.apply(this,[a])},WebSocket.prototype.__handleEvent=function(a){var b,c;if("readyState"in a&&(this.readyState=a.readyState),"protocol"in a&&(this.protocol=a.protocol),"open"==a.type||"error"==a.type)b=this.__createSimpleEvent(a.type);else if("close"==a.type)b=this.__createSimpleEvent("close"),b.wasClean=a.wasClean?!0:!1,b.code=a.code,b.reason=a.reason;else{if("message"!=a.type)throw"unknown event type: "+a.type;c=decodeURIComponent(a.message),b=this.__createMessageEvent("message",c)}this.dispatchEvent(b)},WebSocket.prototype.__createSimpleEvent=function(a){if(document.createEvent&&window.Event){var b=document.createEvent("Event");return b.initEvent(a,!1,!1),b}return{type:a,bubbles:!1,cancelable:!1}},WebSocket.prototype.__createMessageEvent=function(a,b){if(document.createEvent&&window.MessageEvent&&!window.opera){var c=document.createEvent("MessageEvent");return c.initMessageEvent("message",!1,!1,b,null,null,window,null),c}return{type:a,data:b,bubbles:!1,cancelable:!1}},WebSocket.CONNECTING=0,WebSocket.OPEN=1,WebSocket.CLOSING=2,WebSocket.CLOSED=3,WebSocket.__isFlashImplementation=!0,WebSocket.__initialized=!1,WebSocket.__flash=null,WebSocket.__instances={},WebSocket.__tasks=[],WebSocket.__nextId=0,WebSocket.loadFlashPolicyFile=function(a){WebSocket.__addTask(function(){WebSocket.__flash.loadManualPolicyFile(a)})},WebSocket.__initialize=function(){var b,c,d;if(!WebSocket.__initialized){if(WebSocket.__initialized=!0,WebSocket.__swfLocation&&(window.WEB_SOCKET_SWF_LOCATION=WebSocket.__swfLocation),!window.WEB_SOCKET_SWF_LOCATION)return a.error("[WebSocket] set WEB_SOCKET_SWF_LOCATION to location of WebSocketMain.swf"),void 0;window.WEB_SOCKET_SUPPRESS_CROSS_DOMAIN_SWF_ERROR||WEB_SOCKET_SWF_LOCATION.match(/(^|\/)WebSocketMainInsecure\.swf(\?.*)?$/)||!WEB_SOCKET_SWF_LOCATION.match(/^\w+:\/\/([^\/]+)/)||(b=RegExp.$1,location.host!=b&&a.error("[WebSocket] You must host HTML and WebSocketMain.swf in the same host ('"+location.host+"' != '"+b+"'). "+"See also 'How to host HTML file and SWF file in different domains' section "+"in README.md. If you use WebSocketMainInsecure.swf, you can suppress this message "+"by WEB_SOCKET_SUPPRESS_CROSS_DOMAIN_SWF_ERROR = true;")),c=document.createElement("div"),c.id="webSocketContainer",c.style.position="absolute",WebSocket.__isFlashLite()?(c.style.left="0px",c.style.top="0px"):(c.style.left="-100px",c.style.top="-100px"),d=document.createElement("div"),d.id="webSocketFlash",c.appendChild(d),document.body.appendChild(c),swfobject.embedSWF(WEB_SOCKET_SWF_LOCATION,"webSocketFlash","1","1","10.0.0",null,null,{hasPriority:!0,swliveconnect:!0,allowScriptAccess:"always"},null,function(b){b.success||a.error("[WebSocket] swfobject.embedSWF failed")})}},WebSocket.__onFlashInitialized=function(){setTimeout(function(){WebSocket.__flash=document.getElementById("webSocketFlash"),WebSocket.__flash.setCallerUrl(location.href),WebSocket.__flash.setDebug(!!window.WEB_SOCKET_DEBUG);for(var a=0;a<WebSocket.__tasks.length;++a)WebSocket.__tasks[a]();WebSocket.__tasks=[]},0)},WebSocket.__onFlashEvent=function(){return setTimeout(function(){var b,c;try{for(b=WebSocket.__flash.receiveEvents(),c=0;c<b.length;++c)WebSocket.__instances[b[c].webSocketId].__handleEvent(b[c])}catch(d){a.error(d)}},0),!0},WebSocket.__log=function(b){a.log(decodeURIComponent(b))},WebSocket.__error=function(b){a.error(decodeURIComponent(b))},WebSocket.__addTask=function(a){WebSocket.__flash?a():WebSocket.__tasks.push(a)},WebSocket.__isFlashLite=function(){if(!window.navigator||!window.navigator.mimeTypes)return!1;var a=window.navigator.mimeTypes["application/x-shockwave-flash"];return a&&a.enabledPlugin&&a.enabledPlugin.filename?a.enabledPlugin.filename.match(/flashlite/i)?!0:!1:!1},window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION||swfobject.addDomLoadEvent(function(){WebSocket.__initialize()}),void 0)}(),JSON||(JSON={}),function(){"use strict";function f(a){return 10>a?"0"+a:a}function quote(a){return escapable.lastIndex=0,escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,h,g=gap,i=b[a];switch(i&&"object"==typeof i&&"function"==typeof i.toJSON&&(i=i.toJSON(a)),"function"==typeof rep&&(i=rep.call(b,a,i)),typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";if(gap+=indent,h=[],"[object Array]"===Object.prototype.toString.apply(i)){for(f=i.length,c=0;f>c;c+=1)h[c]=str(c,i)||"null";return e=0===h.length?"[]":gap?"[\n"+gap+h.join(",\n"+gap)+"\n"+g+"]":"["+h.join(",")+"]",gap=g,e}if(rep&&"object"==typeof rep)for(f=rep.length,c=0;f>c;c+=1)"string"==typeof rep[c]&&(d=rep[c],e=str(d,i),e&&h.push(quote(d)+(gap?": ":":")+e));else for(d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&h.push(quote(d)+(gap?": ":":")+e));return e=0===h.length?"{}":gap?"{\n"+gap+h.join(",\n"+gap)+"\n"+g+"}":"{"+h.join(",")+"}",gap=g,e}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(a,b,c){var d;if(gap="",indent="","number"==typeof c)for(d=0;c>d;d+=1)indent+=" ";else"string"==typeof c&&(indent=c);if(rep=b,b&&"function"!=typeof b&&("object"!=typeof b||"number"!=typeof b.length))throw new Error("JSON.stringify");return str("",{"":a})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&"object"==typeof e)for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(d=walk(e,c),void 0!==d?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),tools={log:function(){if("undefined"==typeof TOOLS_DEBUG||TOOLS_DEBUG)if("console"in window)for(var a=0,b=arguments.length;b>a;a++)"object"!=typeof arguments[a]?console.log(arguments[a]):console.log(JSON.stringify(arguments[a]));else alert(Array.prototype.slice.call(arguments,0).join(" "))},fLog:function(){if("console"in window)for(var a=0,b=arguments.length;b>a;a++)console.log(arguments[a]);else alert(Array.prototype.slice.call(arguments,0).join(" "))},post:function(a,b,c,d,e,f){toolLq.log(a+"url",c),toolLq.log(a+"data",d),$.post(c,d,e,f)},get:function(a,b,c,d,e){toolLq.log(a+"url",b),toolLq.log(a+"data",$.extend(!0,{},c)),$.get(b,c,d,e)},okAlert:function(a){return a.tip?($.zbtip("ok",a.tip),void 0):("string"==typeof a&&$.zbtip("ok",a),void 0)
},errAlert:function(a){return a.tip?($.zbtip("error",a.tip),void 0):("string"==typeof a&&$.zbtip("error",a),void 0)},alert:function(a){return a.tip?($.zbtip("warm",a.tip),void 0):("string"==typeof a&&$.zbtip("warm",a),void 0)},getStrValue:function(a,b){b=[",",b,","].join("");var c=new RegExp(","+a+":([^,]*),");return b=b.match(c),b?b[1].replace(/&dlq;/g,","):b},setStrValue:function(a,b,c){b=b.replace(/,/,"&dlq;"),c=c?[",",c,","].join(""):"";var d=new RegExp([",",a,":([^,]*),"].join(""));return[c.replace(d,",").slice(1),a,":",b].join("")},strToJson:function(a){var b,c,d;for(a=[",",a,","].join(""),c={},d=new RegExp(',("?[_\\w]+[\\w\\d_]+"?):([^,]+),',"g");null!=(b=d.exec(a));)d.lastIndex--,c[b[1]]=b[2].replace(/&dlq;/g,",");return b=d=null,c},jsonToStr:function(a){var c,b=[];for(c in a)b.push([c,":",a[c]+""].join(""));return b.join(",")},htmlTemplate:function(a,b,c,d){var e;return d=d||["\\$\\{","\\}"],e=[d[0],"([_\\w]+[\\w\\d_]?)",d[1]].join(""),e=new RegExp(e,"g"),a.replace(e,function(a,d){return null!=b[d]&&void 0!=b[d]?b[d]:c?"":a})},jsonDateParse:function(a){var b=new RegExp("['\"]?\\\\/(Date\\(\\d+\\))\\\\/['\"]?","g");return a.replace(b,"new $1")},jsonDateParse1:function(a){var b,c;return b=new RegExp("Date\\((\\d+(?:\\+\\d+)?)\\)"),c=a.match(b),c?new Date(c[1]-0):a},jsonLocalDateParse:function(a){var b=new RegExp("['\"]?\\\\/(Date\\(\\d{13}\\+\\d{4}\\))\\\\/['\"]?","gi");return a.replace(b,"new $1")},jsonToDate:function(a){var b=new RegExp("\\d{13}\\+\\d{4}","gi");return a.match(b)[0]},utcStrParse:function(a,b){var j,c=[],d=new Date,e=new Date,f={y:"FullYear",M:"Month",d:"Date",h:"Hours",m:"Minutes",s:"Seconds"},g=/(\d+)([\D]+)/g,h=0,i=[!1];for(b||(i=[["y","M","d"],["M","d","y"],["d","M","y"],["y","d","M"]]),a+=";",j=0;j<i.length;j++){for(b=i[j]?i[j].concat(["h","m","s"]):b,h=0,d.str=[],e.str=[];null!=(c=g.exec(a));)c.l=c[1].length,"Month"==f[b[h]]&&(c[1]=c[1]-0-1),e["set"+f[b[h]]](c[1]-0),d["setUTC"+f[b[h]]](c[1]-0),e.temp=e["get"+f[b[h]]](),d.temp=d["get"+f[b[h]]](),"Month"==f[b[h]]&&(e.temp++,d.temp++),e.str.push(c.l>(e.temp+"").length?"0"+e.temp:e.temp,c[2]),d.str.push(c.l>(d.temp+"").length?"0"+d.temp:d.temp,c[2]),h++;if(e.str=e.str.slice(0,-1).join(""),d.str=d.str.slice(0,-1).join(""),e.str+";"==a)break}return delete d.temp,d.toString=function(){return d.str},d},getUTCMi:function(a){return Date.UTC(a.getFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds(),a.getUTCMilliseconds())},getUTCStr:function(a){return[a.getFullYear(),"/",a.getUTCMonth()+1,"/",a.getUTCDate()].join("")},dateToString:function(a){return"string"==typeof a&&(a=new Date(a)),["/Date(",a.getTime(),")/"].join("")},dateFormat:function(a,b){var c,d,e,f;a="string"==typeof a?new Date(a):a,c=["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],d=["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],e={"M+":a.getMonth()+1,"d+":a.getDate(),"h+":a.getHours()>12?a.getHours()-12:a.getHours(),"H+":a.getHours(),"m+":a.getMinutes(),"s+":a.getSeconds(),"q+":Math.floor((a.getMonth()+3)/3),w:"0123456".indexOf(a.getDay()),t:a.getHours()<12?"am":"pm",W:c[a.getDay()],L:d[a.getMonth()]},/(y+)/.test(b)&&(b=b.replace(RegExp.$1,(a.getFullYear()+"").substr(4-RegExp.$1.length)));for(f in e)new RegExp("("+f+")").test(b)&&(b=b.replace(RegExp.$1,1==RegExp.$1.length?e[f]:("00"+e[f]).substr((""+e[f]).length)));return b},utcBirth:function(a,b){var c=[x18n.today,x18n.tomorrow],d=new Date(toolLq.utcStrParse(a,b).setHours(8,0,0,0)),e=new Date((new Date).setHours(8,0,0,0)),f=Math.floor((d-e)/864e5);return f>=0?c[f]:d.str},filterJsonChar:function(a,b){switch(b){case"1":return a.replace(/([^\\])(?=['"])/g,"$1$-\\");case"-1":return a.replace(/\$\-\\(['"])/g,"$1")}return a.replace(/['"]/g,"")},filterCRLF:function(a,b){switch(b){case"1":return a.replace(/(\r\n|\r|\n)/gi,"$-n");case"-1":return a.replace(/\$\-n/g,"<br />");case"-1.1":return a.replace(/\$\-n/g,"\n")}return a.replace(/(\r\n|\r|\n)/gi,"\\n")},ltrim:function(a){return a.replace(/^\s+/,"")},rtrim:function(a){return a.replace(/\s+$/,"")},trim:function(a){return a.replace(/^\s*(\S*)\s*$/,"$1")},filterChar:function(a,b){var c=new RegExp(b,"gi");return a.replace(c,"")},filterLt:function(a){return a.replace(/(<|>)/gi,function(a,b){return"<"==b?"&lt;":"&gt;"})},filterScript:function(a,b){b=b||"script";var c=new RegExp(["<\\s*(",b,"[^>]*)>|<\\*s(/)\\s*(",b,"[^>]*)>"].join(""),"gi");return a.replace(c,function(a,b,c,d){return["&lt;",b,c,d,"&gt;"].join("")})},getCharsImgs:function(a,b,c,d,e){var g,f=$(["<div>",a,"</div>"].join("")),h={},i=new RegExp("^"+location.protocol+"//"+location.host,"i");return e=e||100,0!==b&&b?(g=f.find("img:lt("+b+")"),h.imgs=[],g.each(function(){h.imgs.push(['<img src="',this.src.replace(i,""),'" width="',c,'" height="',d,'" />'].join(""))}),h.str=f.text().replace(/\s{2,}/g," ").slice(0,e)):h=f.text().replace(/\s{2,}/g," ").slice(0,e),h},filterHtml:function(a,b,c){b=b||["(html|head|body|iframe|a|area|b|big|br|button|dd|dl|dt|div|dd|fieldset|font|","form|frame|frameset|h1|h2|h3|h4|h5|h6|hr|img|input|label|li|link|map|meta|object|","ol|option|p|script|select|span|style|table|tbody|td|textarea|tfoot|th|thead|title|tr|","tt|ul|img|i|s|u)"].join(""),b=c?b.replace(c,""):b;var d=new RegExp(["<\\s*/?",b,"\\b[^>]*>"].join(""),"gi");return a.replace(d,function(){return""})},filterTag:function(a,b){b=b||"";var c=b?new RegExp(["<\\s*/?(?!",b,"\\b)\\w+\\b[^>]*>"].join(""),"gi"):new RegExp("<\\s*/?\\w+\\b[^>]*>","gi");return a.replace(c,function(){return""})},filterMarkImgs:function(a,b){b=b||"${imgs}";var c=[],d=new RegExp("<\\s*/?img\\b[^>]*(src\\s*=(?:[^>=](?!http:))*\\.(?:png|jpg|gif))[^>]*>","gi");return a=a.replace(d,function(a,d){return c.push(d),b}),{str:a,imgs:c}},filterRecoverImgs:function(a,b,c,d){c=c||"\\$\\{imgs\\}",d=d||{};var e=0,f=new RegExp(c,"gi");return a.replace(f,function(){if(e>=b.length)return"";var a=['<img src="',b[e],'" ',d.width?'width="'+d.width+'" ':"",d.height?'height="'+d.height+'" ':"",d.alt?'alt="'+d.alt+'" ':""," />"].join("");return e++,a})},filterOnlyImg:function(a,b,c){var d=toolLq.filterMarkImgs(a,b);return a=toolLq.filterTag(d.str),toolLq.filterRecoverImgs(a,d.imgs,b,c)},filterEmail:function(a){var b=new RegExp(["@|([\\d零一二三四五六七八九十]\\s?){6,}|","q\\s?q|","m\\s?s\\s?n|","f\\s?a\\s?c\\s?e\\s?b\\s?o\\s?o\\s?k|","F\\s?B|y\\s?a\\s?h\\s?o\\s?o|","h\\s?o\\s?t\\s?m\\s?a\\s?i\\s?l|","s\\s?k\\s?y\\s?p\\s?e|","g\\s?m\\s?a\\s?i\\s?l|","\\.\\s?c\\s?o\\s?m|163.\\s?c\\s?o\\s?m|","h\\s?t\\s?t\\s?p.*\\.\\w{2,4}(\\/\\w*)?\\b"].join(""),"gi");return a.replace(b,"")},offsetParent:function(a,b){var c=null,d=!0,e=Math.max(document.documentElement.scrollLeft,document.body.scrollLeft),f=Math.max(document.documentElement.scrollTop,document.body.scrollLeft);for(e+=a.offsetLeft,f+=a.offsetTop,c=a.offsetParent;(a=a.parentNode)&&a.tagName;)a.id==b&&(d=!1),a==c&&d&&(e+=a.offsetLeft,f+=a.offsetTop,c=c.offsetParent);return a=c=d=null,{left:e,top:f}},objToRuleArr:function(a,b){var d,c=[];for(d=0;d<b.length;d++)c.push(a[b[d]]);return c},emptyFun:function(){},charTran:function(a){var b={lt:"<",gt:">"};return a.replace(/&([^;]+);/gi,function(a,c){return b[c]||a})},getJqPop:function(a,b,c){var d=b.offset(),e={},f={},g=a.parent(),h=$(window),i=[];for(c=$.extend({top:0,left:0},c);"static"==g.css("position")&&"body"!=g[0].tagName.toLowerCase();)g=g.parent();return g.oft=g.offset(),d.outHeight=b.outerHeight(),d.outWidth=b.outerWidth(),f.height=document.documentElement.clientHeight,f.width=document.documentElement.clientWidth,f.scrollTop="body"===g[0].tagName.toLowerCase()?h.scrollTop():0,f.scrollLeft="body"===g[0].tagName.toLowerCase()?h.scrollLeft():0,e.height=a.outerHeight(),e.width=a.outerWidth(),f.height+f.scrollTop-d.top-d.outHeight-c.top>e.height?(e.top=d.top+d.outHeight+c.top,i.push("t")):(e.top=d.top-e.height,i.push("b")),e.left=f.width+f.scrollLeft-d.left-c.left>e.width?d.left+c.left:d.left-(e.width-d.outWidth)+c.left,i={direction:i.join(""),top:Math.floor(e.top-g.oft.top),left:Math.floor(e.left-g.oft.left)}},jqPop:function(a,b,c){var d=toolLq.getJqPop(a,b,c);return a.css({top:d.top,left:d.left}),d.direction},jqRunDataFun:function(a,b,c){return"function"==typeof b.data(a)?b.data(a)(c):null},jqRunDataFun1:function(a){return"function"==typeof this.data(a)?this.data(a).apply(this,Array.prototype.slice.call(arguments,1)):this.data(a)},getStyle:function(a,b){return a.style[b].replace(/\D/gi,"")-0},checkType:{email:/^([a-zA-Z0-9_\.\-])+@(([a-zA-Z0-9\-])+\.)+[a-zA-Z]{2,6}$/,phone:/1[0-9]{10}/},check:function(a,b){return"empty"===b?!0:this.checkType[b].test(a)},constant:{regUrlParam:/\?[^=]+=/},setUrlParam:function(a,b){return"string"==typeof b?toolLq.constant.regUrlParam.test(a)?[a,"&",b].join(""):[a,"?",b].join(""):void 0},generateAvatarByEmail:function(a){var b=a.split("@");return["Upload/Head/",b[1].replace(".",""),"/",a.substring(0,1),"/",a.substring(1,2),"/",a.substring(2,3),"/small_",b[0],".png"].join("")},resizeImg:function(a,b,c,d){var e,f,g=1;return f=c/a,e=d/b,(1>f||1>e)&&(g=e>=f?f:e),1>g&&(a*=g,b*=g),{width:a,height:b}}},toolLq=tools,collectGarbage={fns:{},add:function(a){var b="fn"+(new Date).getTime()+Math.floor(1e3*Math.random());this.fns[b]=a},clear:function(){for(var a in this.fns)"function"==typeof this.fns[a]&&(this.fns[a](),delete this.fns[a]);"function"==typeof window.CollectGarbage&&CollectGarbage()}},function(){LqEvents.prototype.trigger=function(a,b){b=$.extend(!0,{stop:!1},b);for(var c=0,d=this.events[a].length;d>c;c++)if(this.events[a][c].call(this,b),b.stop)return},LqEvents.prototype.bind=function(a,b){arguments.length<2||"function"!=typeof b||(a in this.events||(this.events[a]=[]),this.events[a].push(b))},LqEvents.prototype.unbind=function(a,b){if(arguments.length<1)return this.events={},void 0;if("string"==typeof a&&!b)return this.events[a]=[],void 0;if("string"==typeof a&&"function"==typeof b)for(var c=this.events[a].length;c>=0;c--)if(this.events[a][c]===b)return this.events[a].splice(c,1),void 0}}(),Face=function(){this.target=null,this.callback=null,this.init.call(this,arguments)},Face.emos={QQ:{cn:["[微笑]","[撇嘴]","[色]","[发呆]","[得意]","[流泪]","[害羞]","[闭嘴]","[睡]","[大哭]","[尴尬]","[发怒]","[调皮]","[龇牙]","[惊讶]","[难过]","[酷]","[冷汗]","[抓狂]","[吐]","[偷笑]","[可爱]","[白眼]","[傲慢]","[饥饿]","[困]","[惊恐]","[流汗]","[憨笑]","[大兵]","[奋斗]","[咒骂]","[疑问]","[嘘]","[晕]","[折磨]","[衰]","[骷髅]","[敲打]","[再见]","[擦汗]","[抠鼻]","[鼓掌]","[糗大了]","[坏笑]","[左哼哼]","[右哼哼]","[哈欠]","[鄙视]","[委屈]","[快哭了]","[阴险]","[亲亲]","[吓]","[可怜]","[菜刀]","[西瓜]","[啤酒]","[篮球]","[乒乓]","[咖啡]","[饭]","[猪头]","[玫瑰]","[凋谢]","[示爱]","[爱心]","[心碎]","[蛋糕]","[闪电]","[炸弹]","[刀]","[足球]","[瓢虫]","[屎]","[月亮]","[太阳]","[礼物]","[抱抱]","[强]","[弱]","[握手]","[胜利]","[抱拳]","[勾引]","[拳头]","[差劲]","[爱你]","[NO]","[OK]"],en:["[Smile]","[Grimace]","[Drooling]","[Scowl]","[Chill]","[Sob]","[Shy]","[Silence]","[Sleep]","[Cry]","[Embarrassed]","[On fire]","[Wink]","[Grin]","[Surprised]","[Sad]","[Cool]","[Frightened]","[Scream]","[Puke]","[Chuckle]","[Lovely]","[Sneer]","[Arrogant]","[Hungry]","[Drowsy]","[Panic]","[Sweating]","[Laugh]","[Soldier]","[strive]","[Scold]","[Confused]","[Shhh]","[Hypnotized]","[Torment]","[Frustrated]","[Skull]","[Hammer]","[Wave/Bye]","[Relived/Wipe]","[Pick nose]","[Applause]","[Flushed]","[Hellooo]","[Snub1]","[Snub2]","[Yawn]","[Booo]","[Distressed]","[Sniffle]","[Sly]","[Pucker]","[Scared]","[Pathetic]","[Cleaver]","[Water Melon]","[Beer]","[Basketball]","[Ping Pong]","[Coffee]","[Rice]","[Pig]","[Rose]","[Fade]","[Kisses]","[Heart]","[Broken Heart]","[Cake]","[Lightning]","[Bomb]","[Dagger]","[Football]","[Ladybug]","[Shit]","[Moon]","[Sun]","[Gift]","[Hug]","[Strong]","[Weak]","[Shake]","[Victory]","[Admire]","[Beckon]","[Fist]","[Pinky]","[ILoveU]","[NO]","[OK]"]}},Face._template='<div class="chat-face"><div class="chat-face-wrap"><a class="chat-face-close"></a><div class="chat-face-nav"><ul><li class="on"><a>${defaultText}</a></li></ul></div><div class="chat-face-cont"><ul class="chat-face-list clearfix"></ul></div></div><div class="chat-face-arr"></div></div>',Face.prototype={init:function(a){var b=this;b.callback=a[1],$(a[0]).bind("click",function(a){a.stopPropagation(),b.target=$(this),b.show()}),this.wrap=$(tools.htmlTemplate(Face._template,x18n)),a[2]=a[2]||$("body"),a[2].append(this.wrap),this.render(),this.wrap.bind("click",function(a){a.stopPropagation()}),this.wrap.on("click","ul.chat-face-list li",function(){b.insert($(this).find("img"))}),this.wrap.on("click","a.chat-face-close",function(){b.close()})},render:function(a){this.wrap.find(".chat-face-cont>ul").html(this.getHtml(a))},getHtml:function(a){var b,c,d,e;if(a=a||"QQ",b=Face.emos[a],c=[],!b)return"";for(b=b[x18n.emCode.toLowerCase().substr(2,2)],d=0,e=b.length;e>d;d++)c.push('<li><a><img src="',IM.domain,"/Content/blue/emotions/images/",d,'.gif" title="',b[d],'" /></a></li>');return c.join("")},insert:function(a){var b;b="function"==typeof this.callback?this.callback.call(this,this.target):this.callback,b.append(a.clone()),this.focus(b),this.close()},focus:function(a){var b,c,d=$('<img style="width: 1px; height: 12px;" />')[0];window.getSelection?b=window.getSelection():document.selection&&(b=document.selection.createRange()),a.find("br").remove(),a[0].appendChild(d),document.body.createTextRange?(c=document.body.createTextRange(),c.moveToElementText(d),c.moveStart("character",0),c.moveEnd("character",1),c.select()):(c=document.createRange(),c.deleteContents(),c.setEndAfter(d),c.setStartAfter(d),b.removeAllRanges(),b.addRange(c));try{document.execCommand("Delete",!1,null)}catch(e){try{a[0].removeChild(d)}catch(e){}}a.focus(),a.scrollTop(99999)},show:function(){var a,b=this.wrap,c=this;a=c.target.offset(),b.css({"margin-left":-31,"margin-top":-c.wrap.height()-9,visibility:"visible"}),$(document).unbind("click.face").bind("click.face",function(){c.close()})},close:function(){$(document).unbind("click.face"),this.wrap.css("visibility","hidden")}},template='<div class="chat-win-box"><div class="chat-win" style="display:none;"><div class="chat-win-title dragable"><div class="chat-win-avart"><a href="#"><img src="" alt="" /></a><s class="chat-icon-online" title="${online}"></s></div><div class="chat-win-name"><a href="#"></a></div><div class="chat-win-button"></div></div><div class="chat-win-wrap"><div class="chat-win-talker"><a href="javascript:void(0);" class="pre""></a><div class="chat-win-out"><ul class="chat-win-talkerList chat-tree-child"></ul></div><a href="javascript:void(0);" class="next"></a></div><div class="chat-win-main"><div class="chat-win-notice" style="display: none;"><div class="chat-notice-cont"></div><a class="chat-notice-close"></a></div><div class="chat-win-cont"></div><div class="chat-win-post"><div class="chat-win-tools"><a class="chat-icon-face" href="javascript:;" title="${emotion}"></a><a class="chat-icon-photo" href="javascript:;" id="chat-uploadify" title="${insertImg}"></a><a class="chat-icon-history" href="javascript:;" title="${history}"></a><div class="chat-photo-preview"><img class="chat-pic-thumb" src=""><div class="ab"><div class="abi"></div></div></div></div><div class="chat-win-input" contenteditable="true"></div><div class="chat-win-foot"><div class="chat-win-post-f1"><label>${transate}：</label><span class=""><select><option value="">${noTrans}</option><option value="">${oppolang}</option><option value="en">English</option><option value="cn">简体中文</option><option value="tr">繁體中文</option><option value="ko">한국어</option><option value="rs">Pусский</option><option value="gm">Deutsch</option><option value="sp">Español</option><option value="jp">日本語</option></select></span></div><div class="chat-win-post-f2"><button class="btn-primary chat-bt-post">${send}</button></div><div class="chat-input-tip"></div></div></div></div></div><div class="chat-win-border n-border"></div><div class="chat-win-border e-border"></div><div class="chat-win-border s-border"></div><div class="chat-win-border w-border"></div><div class="chat-win-border ne-border"></div><div class="chat-win-border se-border"></div><div class="chat-win-border sw-border"></div><div class="chat-win-border nw-border"></div></div><div class="chat-minbox" style="display: none"><s class="chat-icon-man"></s><em class="name"></em><span class="chat-minbox-wrap"><span class="chat-unread-num" title=""></span></span></div></div><div class="chat-panel hidden"><div class="chat-panel-title"><s class="chat-icon-chat"></s><em class="name">${chat}</em><div class="notice"><div class="showNotice"></div><ul class="noticeList noticeList_line"></ul></div></div><div class="chat-panel-main"><ul class="chat-panel-tree"><li class="chat-recent-tree"><div class="chat-tree-parent hide"><s class="chat-icon-arr_d"></s>${recentContact}[<span class="chat-num">0</span>/<span class="chat-total">0</span>]</div><ul class="chat-tree-child none"></ul></li><li class="chat-online-tree"><div class="chat-tree-parent hide"><s class="chat-icon-arr_d"></s>${onlineFriend}[<span class="chat-num">0</span>/<span class="chat-total">0</span>]</div><ul class="chat-tree-child none"></ul></li><li class="chat-friends-tree"><div class="chat-tree-parent hide"><s class="chat-icon-arr_d"></s>${myFriend} [<span class="chat-num">0</span>/<span class="chat-total">0</span>]</div></li></ul><ul class="chat-search-tree chat-tree-child none"></ul></div><div class="chat-panel-search"><div class="chat-search-warp"><s class="chat-icon-serach"></s><input class="chat-search-key" type="text" value="" placeholder="${enterFNS}" ></div><div class="chat-flod-btn"><s class="chat-icon-fold"></s></div></div><div class="chat-disable none" title="${reconnect}"></div></div><div class="chat-panel-mini none"><div class="chat-mini-title"><s class="chat-icon-chat"></s><em class="name">${chat}[<span class="chat-num">0</span>/<span class="chat-total">0</span>]</em><span class="chat-num-msg none"></span></div><div class="chat-disable none" title="${reconnect}"></div></div><div class="chat-trans" style="visibility:hidden;"><div class="chat-trans-title">${selectLanguage}</div><div class="chat-trans-list"><a class="chat-trans-item" data-lang="en">English</a><a class="chat-trans-item" data-lang="cn">简体中文</a><a class="chat-trans-item" data-lang="tr">繁體中文</a><a class="chat-trans-item" data-lang="ko">한국어</a><a class="chat-trans-item" data-lang="rs">Pусский</a><a class="chat-trans-item" data-lang="gm">Deutsch</a><a class="chat-trans-item" data-lang="sp">Espa?ol</a><a class="chat-trans-item" data-lang="jp">日本語</a></div></div>',template=tools.htmlTemplate(template,x18n),chatBox=$('<div id="chat-box"></div>'),chatBox.html(template).appendTo("body"),$(".chat-win").delegate("div.chat-win-border","mousedown.resize",function(a){var b=$(this),c=b.css("cursor"),d=b.closest("div.chat-win"),e=d.find("div.chat-win-cont"),f=e.closest("div.chat-win-main"),g=$(".chat-win-out"),h=parseInt(d.attr("min-height"))||378,i=parseInt(d.attr("min-width"))||348,j=200,k=24;return"true"===d.attr("maxed")?!1:(drag({event:a,target:b,win:d,txt:e,cont:f,out:g,cursor:c,heightMin:h,widthMin:i,winWidthBackup:j,winHeightBackup:k,self:b,start:function(a,b){$("html").css("cursor",c);var d=b.range,e=b.win,f=b.winHeightBackup,g=b.winWidthBackup;switch(b.cursor){case"e-resize":d.xMin=a.clientX-e.width()+b.widthMin,d.xMax-=g;break;case"ne-resize":d.xMin=a.clientX-e.width()+b.widthMin,d.xMax-=g,d.yMax=a.clientY+e.height()-b.heightMin,d.yMin+=f;break;case"se-resize":d.xMin=a.clientX-e.width()+b.widthMin,d.xMax-=g,d.yMin=a.clientY-e.height()+b.heightMin;break;case"s-resize":d.yMin=a.clientY-e.height()+b.heightMin;break;case"sw-resize":d.xMax=a.clientX+e.width()-b.widthMin,d.yMin=a.clientY-e.height()+b.heightMin;break;case"w-resize":d.xMax=a.clientX+e.width()-b.widthMin;break;case"nw-resize":d.xMax=a.clientX+e.width()-b.widthMin,d.yMax=a.clientY+e.height()-b.heightMin,d.yMin+=f;break;case"n-resize":d.yMax=a.clientY+e.height()-b.heightMin,d.yMin+=f}return!1},stop:function(){return $("html").css("cursor",""),!1},move:function(a,b,c,d){var e=b.win,f=b.txt,h=b.cont,k=(b.sideBox,b.sideList,d.dx>0?"+="+d.dx:"-="+(0-d.dx)),l=d.dx>0?"-="+d.dx:"+="+(0-d.dx),m=d.dy>0?"+="+d.dy:"-="+(0-d.dy),n=d.dy>0?"-="+d.dy:"+="+(0-d.dy);switch(b.cursor){case"e-resize":e.width(k),h.width(k);break;case"ne-resize":e.css({"margin-top":m,height:n,width:k}),h.width(k),g.height(e.height()-78+"px"),f.height(n);break;case"se-resize":e.css({width:k,height:m}),h.width(k),g.height(e.height()-78+"px");break;case"s-resize":e.height(m),g.height(e.height()-78+"px"),f.height(m);break;case"sw-resize":e.css({"margin-left":k,width:l,height:m}),h.width(k),g.height(e.height()-78+"px"),f.height(m);break;case"w-resize":e.css({"margin-left":k,width:l}),h.width(l);break;case"nw-resize":e.css({"margin-left":k,"margin-top":m,width:l,height:n}),h.width(k),g.height(e.height()-78+"px"),f.height(n);break;case"n-resize":e.css({"margin-top":m,height:n}),g.height(e.height()-78+"px"),f.height(n)}return!1}}),!1)}),ChatWin=function(a){this.win=chatBox.find("div.chat-win");var b={max:!0,min:!0,close:!0,dragable:!0,resize:!0,ratio:100,wordReg:{}};this.config=$.extend(b,a||{}),this.panel=new ChatPanel,this.editor=new ChatEditor,this.init()},ChatWin.prototype.init=function(){var a=this,b=this.config,c=this.win,d=c.find("div.chat-win-button"),e={},f=0;b.min&&$('<a href="javascript:;" class="chat-icon-min"></a>').appendTo(d).bind("click",function(b){b.preventDefault(),c.hide(),c.siblings(".chat-minbox").show(),a.onStateChange("min")}),c.siblings(".chat-minbox").bind("click",function(){return a.show(),a.onStateChange("min-normal"),!1}),b.max&&($('<a href="javascript:;" class="chat-icon-max"></a>').appendTo(d).bind("click",function(a){var b,c,d;a.preventDefault(),b=$(this),c=b.closest(".chat-win"),d=$(window),e={width:c.css("width"),height:c.css("height"),"margin-left":c.css("margin-left"),"margin-top":c.css("margin-top")},f=c.find(".chat-win-cont").height(),c.css({width:d.width()-190,height:d.height()-46,"margin-left":-d.width()+180,"margin-top":-d.height()+24}),c.find(".chat-win-cont").height(c.height()-c.find(".chat-win-title").height()-c.find(".chat-win-post").height()),$(".chat-win-out").height($(".chat-win").height()-78+"px"),$(".chat-win-main").width(c.width()-139+"px"),b.hide().siblings(".chat-icon-normal").show()}),$('<a href="javascript:;" class="chat-icon-normal" style="display: none"></a>').appendTo(d).bind("click",function(a){var b,c;a.preventDefault(),b=$(this),c=b.closest(".chat-win"),c.css(e),c.find(".chat-win-cont").css("height",f),$(".chat-win-out").height(c.height()-78+"px"),$(".chat-win-main").width(c.width()-139+"px"),b.hide().siblings(".chat-icon-max").show()})),b.close&&$('<a href="javascript:;" class="chat-icon-close"></a>').appendTo(d).bind("click",function(b){b.preventDefault(),$(".chat-win-talkerList li").remove(),$(".chat-win-talkerList").css("top","0"),$(".chat-win-out").css("height","300px"),$(".chat-win-main").css("width","346px"),c.css({width:"485px",height:"378px"}),c.hide(),a.onStateChange("close")}),b.dragable&&c.delegate("div.chat-win-title","mousedown.drag",function(a){if(!$(a.target).hasClass("dragable"))return!1;var b=$(this),c=b.closest(".chat-win");return drag({event:a,target:c,start:function(a,b){var c=b.range;c.xMax-=200,c.yMin+=24}}),!1}),c.delegate("div.chat-win-input","keyup",function(){var e,d=0,f=c.find("div.chat-win-foot select").val();""!==f?(e=c.find("div.chat-win-input"),d=$.trim(e.text()).length,a.updateStateTip(x18n.theCountOfChar.replace("#count#","<var>"+d+"</var>"))):a.updateStateTip()}),c.delegate("div.chat-win-foot select","change",function(){c.find("div.chat-win-input").trigger("keyup")}),c.delegate(".chat-bt-post","click",function(){var b=$(this).closest(".chat-win-foot").find("select").val(),d=c.find(".chat-photo-preview").css("visibility","hidden").find("img").attr("src");d&&(d='<div><img class="chat-pic-thumb" style="width: 100px;height: 100px;" src="'+d+'" /> </div>',c.trigger("colsePreview.chat")),a.editor.onSend({content:a.editor.getContent()+d,tran:""!==b,trantype:b?IM.config.language+"@"+b:""})}),new Face(c.find("a.chat-icon-face"),c.find("div.chat-win-input"),c.find(".chat-win-tools")),c.find("a.chat-icon-photo").uploadify({width:16,height:16,swf:IM.domain+"/Content/uploadify/uploadify.swf",uploader:IM.domain+"/Service/UploadImage",buttonImage:IM.domain+"/Content/images/im_uploadify.png",removeCompleted:!1,fileTypeExts:"*.gif; *.jpg;*.jpeg; *.png",onlyone:!0,multi:!1,fileSizeLimit:"500KB",overrideEvents:["onDialogClose"],onSelect:function(){a.editor.input.css({height:"40px","margin-top":"16px"}),$("#chat-uploadify-queue").show(),c.find(".chat-photo-preview").css("visibility","hidden").find("img").attr("src",""),a.updateStateTip(),a.closeNotice()},onUploadSuccess:function(b,d){d=$.parseJSON(d),1===d.flag?(c.find(".chat-photo-preview").css("visibility","visible").find("img").attr("src",d.tip),$("#"+b.id).find(".uploadify-progress").hide()):($("#"+b.id).remove(),a.editor.input.css({height:"52px","margin-top":"4px"}),a.updateStateTip('<span style="color: #ff0000">'+d.tip+"</span>"))},onCancel:function(){c.trigger("colsePreview.chat")},onSelectError:function(){var b=arguments;b[0].size>5e5?a.showNotice(x18n.fileSizeExceedsLimit):a.showNotice(b[2])}}),c.bind("colsePreview.chat",function(){c.find(".chat-photo-preview").css("visibility","hidden").find("img").attr("src",""),a.editor.input.css({height:"52px","margin-top":"4px"}),$("#chat-uploadify-queue").hide()}),c.delegate("img.chat-pic-thumb","click",function(){ImgViewer.show(this.src)}),c.delegate("a.chat-notice-close","click",function(){a.closeNotice()})},ChatWin.prototype.show=function(a){var b=this,c=b.win;a&&(b.editor.input.css({height:"52px","margin-top":"4px"}),$("#chat-uploadify-queue").empty().hide(),c.css({width:"485px",height:"378px","margin-top":"-381px","margin-left":"-507px"}),b.panel.panel.height(230),c.find("div.chat-photo-preview").css({visibility:"hidden"})),c.show().siblings(".chat-minbox").hide(),$(document).unbind("click.chat").bind("click.chat",function(a){$(a.target).closest("#chat-box").size()||(c.is(":visible")&&b.hide(),$(document).unbind("click.chat"))})},ChatWin.prototype.hide=function(){this.win.hide().siblings(".chat-minbox").show()},ChatWin.prototype.close=function(){this.win.hide().siblings(".chat-minbox").hide()},ChatWin.prototype.updateHeadImg=function(a){var b=this.win.find("div.chat-win-title"),c=[];c.push('<a href="',a.href,'" target="_blank"><img src="'+a.src+'" alt="" /></a>'),a.online&&c.push('<s class="chat-icon-online" title="',x18n.online,'"></s>'),b.find(".chat-win-avart").html(c.join(""))},ChatWin.prototype.updateTitle=function(a){this.win.find("div.chat-win-title .chat-win-name").html(a)},ChatWin.prototype.showNotice=function(a,b){var c=this,d=c.win.find("div.chat-win-notice"),e=d.next(),f=d.is(":visible");d.children(".chat-notice-cont").html(a),f||(d.show(),e.height(e.height()-d.outerHeight())),b&&setTimeout(function(){c.hide()},b)},ChatWin.prototype.closeNotice=function(){var a=this.win.find("div.chat-win-notice"),b=a.next();a.is(":visible")&&(b.height(b.height()+a.outerHeight()),a.hide())},ChatWin.prototype.updateStateTip=function(a){a=a||"",this.win.find("div.chat-input-tip").html(a).attr("title",tools.filterTag(a))},ChatWin.prototype.updateMinWindowBar=function(a){var b=this.win.siblings(".chat-minbox");a.title&&b.find(".name").text(a.title).attr("title",a.title),a.num&&b.find(".chat-unread-num").show().text(a.num)},ChatWin.prototype.setProperty=function(a){function c(a){switch(a.toLowerCase()){case"zh-cn":return"cn";case"zh-tw":return"tr";case"de-de":return"gm";case"es-es":return"sp";case"ja-jp":return"jp";case"ru-ru":return"rs";case"ko-kr":return"ko";default:return"en"}}if(a.lang){var b=this.win.find(".chat-win-foot select")[0];b.options[1].value=c(a.lang),b.selectedIndex=1}0==a.sex&&(b.value="")},ChatPanel=function(){this.panel=chatBox.find(".chat-win-cont"),this.init()},ChatPanel.prototype.init=function(){var a=this;this.panel.delegate("img.chat-pic-thumb","click",function(){ImgViewer.show(this.src)}),this.panel.on("click","a.chat-msg-retry",function(){var b=$(this).closest(".chat-item").attr("id");a.onRetry(b)}),this.translate()},ChatPanel.prototype.getItemTpl=function(a){var d,e,f,b=['<div id="${id}" class="chat-item chat-item-${style}">','<div class="chat-item-warp" style="background: ${background};">','<div class="chat-item-content">${content}</div>','<div class="chat-item-tools">','<span class="chat-item-time">${date}</span>',"${translate}","</div>",'<s class="chat-icon-arrow"></s>',"</div>","</div>"],c=[];for(e=0,f=a.length;f>e;e++)d=a[e],!d.istran&&/^\d/.test(d.date)?d.translate='<a class="chat-item-transbtn">'+x18n.transate+"</a>":d.istran&&!d.trancontent?d.translate=IM.config.Gold<=0?'<a href="https://www.gagahi.com/Home#/Recharge/List!/Recharge/send" class="chat-item-transing">'+x18n.noGold+"</a>":'<span class="chat-item-transing">'+x18n.onTranslate+"</span>":d.istran&&d.trancontent&&(d.translate='<a class="chat-trans-show" data-yuw="'+d.content+'" data-yiw="'+d.trancontent+'">'+x18n.showBtnName+"</a>",d.content=d.trancontent),c.push(tools.htmlTemplate(b.join(""),d,!0));return c.join("")},ChatPanel.prototype.addMsg=function(a,b){var c=null,d=!1;"string"==typeof a?(d=!0,c=$('<div class="chat-item-ts"><span class="chat-icon-prompt"></span>'+a+"</div>")):c=this.getItemTpl(a),b&&"top"===b?(this.panel.prepend(c),this.panel.scrollTop(0)):(this.panel.append(c),this.panel.scrollTop(this.panel[0].scrollHeight)),d&&setTimeout(function(){c.remove(),c=null},3e3)},ChatPanel.prototype.getMsg=function(a){var b=this.panel.find("id");return b.length?{id:a,content:b.find(".chat-item-content").html(),date:b.find(".chat-item-time").text(),style:b.hasClass("chat-item-left")?"left":"right",background:b.find(".chat-item-warp").css("background")}:null},ChatPanel.prototype.gotoMsg=function(a){var d,b=$("#"+a),c=this.panel;if(b.size()){for(d=c.children(":first");!d.is(":visible");)d=d.next(),d.size()||d.parent();c.scrollTop(b.offset().top-d.offset().top||0)}},ChatPanel.prototype.removeMsg=function(a){a?this.panel.find("#"+a).remove():this.panel.empty()},ChatPanel.prototype.updateMsg=function(a,b,c){var e,d=this.panel.find("#"+a);if(d.size()){if("string"==typeof b)return d.attr("id",b),void 0;switch(d.after(e=$(this.getItemTpl([b]))),d.remove(),c){case"error":e.children(".chat-item-warp").append('<a class="chat-msg-error" title="'+x18n.sendFail+'"></a>');break;case"alert":e.children(".chat-item-warp").append('<a class="chat-msg-alert" title="'+x18n.sendFail+'"></a>')}d=null,e=null}},ChatPanel.prototype.translate=function(){var a=this.panel,b=$("#chat-box").find(".chat-trans"),c=this;a.delegate("a.chat-item-transbtn","click",function(){var c=$(this),d=$(window),e=c.offset();return e.top-d.scrollTop()+c.height()+b.height()>d.height()?b.css("margin-top",e.top-d.height()-d.scrollTop()-b.height()):b.css("margin-top",e.top-d.height()-d.scrollTop()+c.height()),c.closest(".chat-item").hasClass("chat-item-right")?b.css("margin-left",e.left-b.width()+c.width()-d.scrollLeft()):b.css("margin-left",e.left-d.scrollLeft()),b.css("visibility","visible").data("transItem",c.closest(".chat-item").attr("id")),$(document).bind("click.chatTrans",function(){$(document).unbind("click.chatTrans"),b.css("visibility","hidden")}),!1}),b.delegate("a.chat-trans-item","click",function(){var a=$(this),b=a.closest(".chat-trans").data("transItem");c.onTranslate(b,a.attr("data-lang")),IM.config.Gold<=0?$("#"+b).find(".chat-item-transbtn").replaceWith('<a href="https://www.gagahi.com/Home#/Recharge/List!/Recharge/send" class="chat-item-transing">'+x18n.noGold+"</a>"):$("#"+b).find(".chat-item-transbtn").replaceWith('<span class="chat-item-transing">'+x18n.onTranslate+"</span>")}),a.bind("scroll",function(){b.css("visibility","hidden")}),a.delegate("a.chat-trans-show","click",function(){var a=$(this),b=a.closest(".chat-item").find(".chat-item-content");a.text()===x18n.showBtnName?(b.html(a.attr("data-yuw")),a.text(x18n.hiddenBtnName)):(b.html(a.attr("data-yiw")),a.text(x18n.showBtnName))})},ChatPanel.prototype.onTranslate=function(){},ChatPanel.prototype.updateTransState=function(){var a=this.panel.find("#"+arguments[0]);
a.size()&&(arguments[1]?a.find(".chat-item-warp").append('<a class="chat-msg-error" title="'+x18n.sendFail+'"></a>').find(".chat-item-tools").html(arguments[1]):a.find(".chat-item-transing").remove())},ChatEditor=function(){this.input=chatBox.find(".chat-win-input"),this.init()},ChatEditor.prototype.init=function(){this.input.bind("paste",function(){var b=$(this),c=$("<i />");setTimeout(function(){b.children().each(function(){var d,a=$(this),b=/^.+(\[face\])$/i;return a.is("img")?(d=a.attr("src"),b.test(d)||a.remove(),void 0):(a.replaceWith(c.text(a.text()).html()),void 0)})},0)}),this.input.bind("keydown",function(a){return 13===a.which?($("#chat-box").find(".chat-bt-post").trigger("click"),!1):void 0})},ChatEditor.prototype.onSend=function(){},ChatEditor.prototype.getContent=function(){return this.input.html()},ChatEditor.prototype.setContent=function(a){this.input.html(a||"")},ImgViewer=function(){function b(b){var c=$(window),d=a.find("div.img-viewer-warp").css({opacity:0});d.find("img").remove(),$('<img class="dragable" />').appendTo(d).one("load",function(){d.css({"margin-left":-d.width()/2,"margin-top":-d.height()/2}),d.animate({opacity:1},"slow")}).attr("src",b),a.css({width:c.width(),height:c.height(),"margin-top":-c.height()}).find(".img-viewer-lay").animate({opacity:.49}),c.unbind("resize.viewer").bind("resize.viewer",function(){var b=$(this);a.css({width:b.width(),height:b.height(),"margin-top":-b.height()})})}function c(){a.find(".img-viewer-lay").animate({opacity:0},"fast",function(){a.css({"margin-top":0})}),$(window).unbind("resize.viewer")}var a=$('<div class="chat-img-viewer"><div class="img-viewer-lay"></div><div class="img-viewer-warp"><img src="" class="dragable" /><a class="img-viewer-close"></a></div></div>');return a.delegate(".dragable","mousedown.drag",function(a){var c,b=$(this);return $(a.target).hasClass("dragable")?(c=b.closest(".img-viewer-warp"),drag({event:a,target:c,start:function(a,b){var c=b.range;c.xMax+=9999,c.xMin-=9999,c.yMax+=9999,c.yMin-=9999}}),!1):!1}),a.on("click",".img-viewer-lay,.img-viewer-close",function(a){a.stopPropagation(),c()}),chatBox.append(a),$(document).bind("keydown.viewer",function(a){27===a.which&&c()}),{show:b,close:c}}(),Env=function(){var a={winH:{value:$(window).height(),fns:[]}};return $(window).bind("resize.im",function(){var c,d,b=a.winH;for(b.value=$(this).height(),c=0,d=b.fns.length;d>c;c++)b.fns[c](b.value)}),{getEnv:function(b,c){return b in a?("function"==typeof c&&a[b].fns.push(c),a[b].value):null}}}(),ImgViewer=function(){function b(b){var c=$(window),d=a.find("div.img-viewer-warp").css({opacity:0});d.find("img").remove(),$('<img class="dragable" />').appendTo(d).one("load",function(){d.css({"margin-left":-d.width()/2,"margin-top":-d.height()/2}),d.animate({opacity:1},"slow")}).attr("src",b),a.css({width:c.width(),height:c.height(),"margin-top":-c.height()}).find(".img-viewer-lay").animate({opacity:.49}),c.unbind("resize.viewer").bind("resize.viewer",function(){var b=$(this);a.css({width:b.width(),height:b.height(),"margin-top":-b.height()})})}function c(){a.find(".img-viewer-lay").animate({opacity:0},"fast",function(){a.css({"margin-top":0})}),$(window).unbind("resize.viewer")}var a=$('<div class="chat-img-viewer"><div class="img-viewer-lay"></div><div class="img-viewer-warp"><img src="" class="dragable" /><a class="img-viewer-close"></a></div></div>');return a.delegate(".dragable","mousedown.drag",function(a){var c,b=$(this);return $(a.target).hasClass("dragable")?(c=b.closest(".img-viewer-warp"),drag({event:a,target:c,start:function(a,b){var c=b.range;c.xMax+=9999,c.xMin-=9999,c.yMax+=9999,c.yMin-=9999}}),!1):!1}),a.on("click",".img-viewer-lay,.img-viewer-close",function(a){a.stopPropagation(),c()}),chatBox.append(a),$(document).bind("keydown.viewer",function(a){27===a.which&&c()}),{show:b,close:c}}(),MsgModel.prototype=new LqEvents,function(a,b){function d(a,b){var c,d;return a in this.data||(c=this.data[a]=[],this._dataIndex[a]={},c.noReadMsg=[],c.noReadTran=[]),d=this._dataIndex[a],b?this.data[a][d[b]]:this.data[a]}function e(a){var b=this._timeOutData;return a in b||(b[a]=[]),b[a]}function f(a,b,c){var f=c||b.msgid,g=d.call(this,a),h=e.call(this,a);b.msgdate&&(b.msgdate=toolLq.utcStrParse(b.msgdate).str||b.msgdate),g.push(b),this._dataIndex[a][f]=c?f.slice(a.length+1)-0:g.length-1,h.push(f),this.updateNoRead(a,f,"noReadMsg"),this.trigger("msgChange",{name:a,id:f,type:"insertMsg"})}function g(a){this.updateMsg(a.receiver,a.msgtempid,a)}function h(a,b){this.updateMsg(a,b.msgid,{istran:!0,rancontent:b.msgcontent},"transReceive"),this.updateNoReadTran(a,"push",b.msgid)}function i(a){a.sender===this._state.receiver&&(this._winParam.state="gray",this._winParam.title=['<a href="',this._winParam.href,'" target="_blank">',this._state.receiver,"（",x18n.offline,"）</a>"].join(""),this.trigger("winParamChange",{param:this._winParam,type:"offline"}))}function j(a){a.sender===this._state.receiver&&(this._winParam.state="color",this._winParam.title=['<a href="',this._winParam.href,'" target="_blank">',this._state.receiver,"（",x18n.online,"）</a>"].join(""),this.trigger("winParamChange",{param:this._winParam,type:"online"}))}function k(a){switch(a.msgcode){case"101":j.call(this,a);break;case"102":i.call(this,a);break;case"001":f.call(this,a.sender,a);break;case"002":g.call(this,a);break;case"301":h.call(this,a.receiver,a);break;case"401":h.call(this,a.sender,a);break;default:this.trigger("message",a)}}var c=0;b.getMsg=function(a,b){return a in this.data?b?b in this._dataIndex[a]?[this.data[a][this._dataIndex[a][b]]]:[]:this.data[a]:[]},b.sendMsg=function(a){var b=a.receiver+"_"+this.getMsg(a.receiver).length,c={msgcode:"001",sender:IM.config.name,receiver:a.receiver,msgid:"",msgtempid:b,msgdate:x18n.sending,msgcontent:a.content,istran:a.tran,trantype:a.trantype,msgbody:"{}"},d=JSON.stringify(c);f.call(this,a.receiver,c,b),toolLq.log("发送消息",d),this.socket.send(d),this.trigger("msgChange",{name:a.receiver,id:b,type:"sendMsg"})},b.sendTrans=function(a,b){this.socket.send(JSON.stringify({msgcode:"501",sender:IM.config.name,receiver:this._state.receiver,msgid:a,trantype:IM.config.language+"@"+b})),this.trigger("msgChange",{name:this._state.receiver,id:a,type:"sendTrans"})},b.setWinParam=function(a){$.extend(this._winParam,a),this.trigger("winParamChange",{param:this._winParam,type:"set"})},b.setState=function(a){a?$.extend(this._state,a):this._state={},this.trigger("stateChange",{param:this._state,type:"set"})},b.updateNoRead=function(a,b,c){var e=d.call(this,a),f=this._state;(f.receiver!==a||"min"===f.winState)&&(b?(e[c].push(b),this.trigger("noReadChange",{name:a,id:b,record:c,data:e[c].slice(0),type:"insert"})):(e[c]=[],this.trigger("noReadChange",{name:a,record:c,data:[],type:"clear"})))},b.getNoRead=function(a,b){var c=d.call(this,a);return c[b]},b.updateMsg=function(a,b,c,e){var f,g,h;a in this._dataIndex&&b in this._dataIndex[a]&&(g=d.call(this,a,b),g&&(g=$.extend(!0,{},g,c),c.msgdate&&(g.msgdate=toolLq.utcStrParse(g.msgdate).str||c.msgdate),f=this._dataIndex[a],this.data[a][f[b]]=g,c.msgid&&(h=f[b],delete f[b],f[c.msgid]=h),this.trigger("msgChange",{name:a,id:g.msgid||b,type:e||"updateMsg"})))},b.reSendMsg=function(a,b,c){var f=d.call(this,a,b),g=e.call(this,a);c&&$.extend(!0,f,c),f.msgid="",f.msgdate=x18n.sending,f.istran=!1,f.trantype="",f.isError="",this.socket.send(JSON.stringify(f)),g.push(b),this.updateMsg(a,b,f,"resend")},b.updateNoReadTran=function(a,b,c){var e=d.call(this,a),g=(this._dataIndex[a],e.noReadTran);if(arguments.length<2)return e.noReadTran=[],this.trigger("noReadChange",{name:a,record:"noReadTran",data:[],type:"clearTran"}),void 0;switch(b){case"push":if(!c||$.inArray(c,g)>-1)return;g.push(c),this.trigger("noReadChange",{name:a,id:c,record:"noReadTran",data:g.slice(0),type:"pushTran"});break;case"pop":g.pop(),this.trigger("noReadChange",{name:a,id:c,record:"noReadTran",data:g.slice(0),type:"popTran"})}},b.init=function(){var a=this;this.socket.bind("message",function(b){var c=JSON.parse(b.data);toolLq.log("msgModel收到消息",c),a.dispose(c)})},b.destroy=function(){clearTimeout(c)},b.dispose=function(a){if(a instanceof Array)for(var b=0,c=a.length;c>b;b++)k.call(this,a[b]);else k.call(this,a)}}(MsgModel,MsgModel.prototype),function(){function c(){var c,a=this.model.getNoRead(this.receiverName,"noReadTran"),b=a.length;return 0===b?null:c=[x18n.receiveTranNum.replace("#n#",['<span style="color:red">&nbsp;',b,"&nbsp;</span>"].join("")),'&nbsp;<a href="javascript:void(0);" class="chat-goto-tranmsg" data-im="id:',a[b-1],'">',,x18n.clickView,"</a>"].join("")}function d(a){var c,d,b=[];for(c=0,d=a.length;d>c;c++)b.push({id:a[c].msgid||a[c].msgtempid,content:a[c].msgcontent,date:a[c].msgdate,istran:a[c].istran,trancontent:a[c].trancontent,style:a[c].sender===this.senderName?"right":"left"});return b}function e(a){var b=toolLq.getStrValue("id",this.getAttribute("data-im")),c=a.model.getMsg(a.receiverName,b);if(b)return c.length?(a.view.panel.gotoMsg(b),void 0):(a.gotoHistory(b,a.receiverName),void 0)}function f(a){switch(a.msgcode){case"203":if(this.receiverName!=a.receiver)return;this.view.panel.addMsg(a.msgcontent);break;case"204":if(this.receiverName!=a.receiver)return;this.view.panel.addMsg(a.msgcontent),this.view.panel.updateTransState(a.msgtempid,x18n.sendFail,'，<a class="chat-msg-retry">',x18n.retry,"</a>");break;case"205":if(this.receiverName!=a.receiver)return;this.view.panel.addMsg(a.msgcontent),this.view.panel.updateTransState(a.msgid);break;case"103":case"104":this.destroy()}}MsgControl.prototype.open=function(a){var g,b=a.name,e=this.getHome(b),f=!("online"!==a.online);if(b&&(this.model.setWinParam({title:['<a href="',e,'" target="_blank">',b,"</a> "].join(""),src:a.icon,href:e,target:"_blank",state:"color",online:f}),this.model.setState({receiver:b,winState:"normal"}),IM.config.name!=b)){if(this.receiverName==b)return this.view.show(),void 0;this.receiverName=b,this.senderName=IM.config.name,this.winReset(),this.view.setProperty({lang:a.language,sex:IM.config.sex}),this.view.panel.addMsg(d.call(this,this.model.getMsg(b))),this.view.show(!0),this.view.updateMinWindowBar({title:b}),g=c.call(this),g&&this.view.showNotice(g)}},MsgControl.prototype.winReset=function(a,b){"string"==typeof a&&this.view.updateTitle(a),"object"==typeof b&&this.view.updateHeadImg(b),this.view.closeNotice(),this.view.panel.removeMsg(),this.view.editor.setContent(""),this.view.updateStateTip("")},MsgControl.prototype.getNoReadNum=function(a,b){return this.model.getNoRead(a,b).length},MsgControl.prototype.clearReadNum=function(a){this.model.updateNoRead(a,null,"noReadMsg")},MsgControl.prototype.init=function(){var a=this;this.view=new ChatWin,this.view.removeMsgTip=function(b){var c=a.view.panel.panel;c.children(".chat-item-ts").filter(b).remove()},this.view.editor.onSend=function(b){return b.content?(b.receiver=a.receiverName,a.model.sendMsg(b),a.view.editor.setContent(""),void 0):(a.view.updateStateTip(x18n.messageIsNotEmpty),void 0)},this.view.onStateChange=function(b){switch(b){case"min":a.model.setState({winState:"min"});break;case"close":a.model.setState(),a.receiverName=null;break;case"min-normal":a.clearReadNum(a.receiverName),a.model.setState({winState:"normal"})}},this.view.panel.onTranslate=function(b,c){a.model.sendTrans(b,c)},this.view.panel.onRetry=function(){},this.view.win.on("click",".chat-goto-tranmsg",function(b){return e.call(this,a),a.model.updateNoReadTran(a.receiverName,"pop"),b.stopPropagation(),!1}).on("click",".chat-goto-msg",function(){e.call(this,a)}).on("click",".chat-msg-retry",function(b){var c=toolLq.getStrValue("id",this.getAttribute("data-im"));return a.model.reSendMsg(a.receiverName,c),a.view.removeMsgTip(':has(.chat-msg-retry[data-im*="id:'+c+'"])'),b.stopPropagation(),!1}),this.view.win.on("click",".chat-icon-history",function(){a.gotoHistory(null,a.receiverName,IM.config.session)}),this.model.bind("message",function(b){a.dispose(b)}),this.model.bind("msgChange",function(b){if(b.name===a.receiverName){var f,c=a.model.getMsg(b.name,b.id),e=d.call(a,c);switch(b.type){case"insertMsg":a.view.panel.addMsg(e);break;case"resend":case"updateMsg":a.view.panel.updateMsg(c[0].msgtempid,e[0]);break;case"transReceive":a.view.panel.updateMsg(c[0].msgid,e[0]);break;case"timeout":e[0].date=[x18n.sendFail,x18n.comma,x18n.please,'<a data-im="id:',b.id,'" class="chat-msg-retry">',x18n.retry,"</a>"].join(""),a.view.panel.updateMsg(b.id,e[0],"error"),f=[x18n.quotation.replace("#c#",['<a data-im="id:',b.id,'" class="chat-goto-msg">',toolLq.filterLt(toolLq.filterHtml(e[0].content)).slice(0,7),"...","</a>"].join("")),e[0].date].join(""),a.view.panel.addMsg(f)}}}),this.model.bind("winParamChange",function(b){a.view.updateTitle(b.param.title),a.view.updateHeadImg(b.param)}),this.model.bind("noReadChange",function(b){if(b.name===a.receiverName){var e,d="";switch(b.type){case"insert":e=a.model.getMsg(b.name,b.id)[0],d=['<span style="color:blue">',e.sender,":</span>",e.msgcontent].join(""),a.view.updateMinWindowBar({info:d});break;case"clear":a.view.updateMinWindowBar({info:d});break;case"pushTran":case"popTran":case"clearTran":if(d=c.call(a),!d&&"noReadTran"===a.noticeDate.state){a.view.closeNotice(),a.noticeDate.state="";break}a.view.showNotice(d),a.noticeDate.state="noReadTran"}}})},MsgControl.prototype.destroy=function(){this.view.close(),this.model.destroy()},MsgControl.prototype.dispose=function(a){if(a instanceof Array)for(var b=0,c=a.length;c>b;b++)f.call(this,a[b]);else f.call(this,a)}}(MsgControl,MsgControl.prototype),function(){function a(a,b){var e,g,h,c=a.indexs,d=a.length,f=!!(b instanceof Array);if(f)for(a=a.concat(b),g=0,h=b.length;h>g;g++)c[b[g]]=d,d++;else{for(e=[],c={},g=0;d>g;g++)a[g]in b||(e.push(a[g]),c[a[g]]=e.length-1);a=e}return a.indexs=c,a}function c(a){var d,e,f,b=a.data.This,c=b.trees.searchRoot;switch(a.keyCode){case 13:return c.find("li.select").trigger("click"),void 0;case 38:d="prev";break;case 40:d="next";break;default:return}e=c.children(),f=e.filter(".select").removeClass("select")[d](),f.length<1&&(f="prev"===d?e.last():e.first()),f.addClass("select")}function d(a){this.msgWin.clearReadNum(a),this.msgWin.open(this.getData(a))}function e(a,b){var e,f,g,c={},d=this.msgWin;for(!(a instanceof Array)&&(a=[a]),e=0,f=a.length;f>e;e++)c[a[e].sender]=null;for(g in c)this.updateNode(g,{numMsg:d.getNoReadNum(g,b)})}function f(a,b){var e,g,h,i,m,j,k,l,c={},d=this.msgWin;for(this._state,!(a instanceof Array)&&(a=[a]),g=0,h=a.length;h>g;g++)c[a[g].sender]=null;for(i in c){if(j=d.getNoReadNum(i,b),e=this.getData(i),k="",l="",e=this.getData(i),l+='<a href="javascript:void(0); data-name='+e.name+'"><img width=16 height=16 src="https://im.gagahi.com/Content/images/new.gif"></a>',k+="<li data-id="+e.name+">",k+="<img width=20 src="+e.icon+" data-name="+e.name+'></img><p class="chat-user-name">'+e.name+'</p><span class="chat-num-tran none" title="'+e.newTrans+'"></span><s class="chat-icon-'+e.online+'" title="'+e.online+'"></s>',k+="</li>",1!=j)return;$("div.notice .noticeList").prepend(k),m=$(".noticeList").children().length,m>=1&&($("div.notice .showNotice").html(l),$(".notice").hover(function(){$(".noticeList").show(),$(".noticeList li").on("click",function(a){var e,b=$(this).children().attr("data-name"),c=$(this),d=c.attr("data-id");return c.remove(),m=$(".noticeList").children().length,0==m&&$("div.notice .showNotice").html(""),c.find("img").addClass("chat-user-pic"),IM.friendsPanel.openMsgWin(b),a.stopPropagation(),e=$(".chat-win-talkerList li").length,e>=1?$(".chat-win-talkerList li").each(function(){$(this).attr("data-id"),$(".chat-win-talkerList").find("."+d).remove(),$(".chat-win-talker .chat-win-talkerList").prepend(c.removeClass("noticeList_line").addClass(d,"chat-tree-child"))}):$(".chat-win-talker .chat-win-talkerList").prepend(c.removeClass("noticeList_line").addClass(d,"chat-tree-child")),$(".chat-win-talkerList li").on("click",function(){var b=$(this).attr("data-id");IM.friendsPanel.openMsgWin(b),a.stopPropagation()}),!1})},function(){$(".noticeList").hide()})),this.updateNode(i,{numMsg:d.getNoReadNum(i,b)})}}function g(a){var b,c,d,e;for(!(a instanceof Array)&&(a=[a]),d=0,e=a.length;e>d;d++)c=a[d].sender,b=this.getData(c),b||(b=this.defaultData(c),this.joinGroup(b,this.stranger))}function h(a){var b;switch(a.msgcode){case"101":this.updateOnline(a.sender,"online");break;case"102":this.updateOnline(a.sender,"offline");break;case"001":g.call(this,a),e.call(this,a,"noReadMsg"),f.call(this,a,"noReadMsg");break;case"201":b=JSON.parse(a.msgcontent),b[0].push({name:this.stranger,children:[]}),this.updateTrees(b);break;case"210":this.setData(a.receiver,"language",a.msgcontent),this.onGetInfo(a.receiver);break;case"103":case"104":this.disable(!1,!0)}}FriendsPanel.prototype.html={parent:['<li data-groupName="${title}" class="${treeClass}"><div class="chat-tree-parent hide"><s class="chat-icon-arr_d"></s>${title}[<span class="chat-num">${num}</span>/<span class="chat-total">${total}</span>]</div>',"</li>"],child:['<ul class="chat-tree-child none">',['<li data-id="${name}" title="${name}"><img class="chat-user-pic" src="${headImg}" />','<p class="chat-user-name">${name}</p><span class="chat-num-tran none" title="${newTrans}"></span><span class="chat-num-msg none" title="${newNotice}"></span>','<s class="chat-icon-${online}" title="${online}"></s>',"</li>"].join(""),"</ul>"],updateNode:{num:".chat-num",total:".chat-total",name:".chat-user-name"}},FriendsPanel.prototype.getData=function(a){return a?this.trees.data[a]:this.trees.data},FriendsPanel.prototype.setData=function(a,b,c){var d=this.getData(a);d&&(d[b]=c)},FriendsPanel.prototype.defaultData=function(a,b){return b||(b=this.trees.data[a]={}),b.name=a,b.online="offline",b.infoOk=!1,b.icon=IM.config.getHeadImg(b.name)||IM.config.defHeadImg,b},FriendsPanel.prototype.joinGroup=function(a,b){var d,e,c=this.trees.friends.filter('[data-groupName="'+b+'"]');c.length<1||(d=c.children(".chat-tree-child"),d.length<1?(e=$(this.createNode([a],null,"all")),c.children(".chat-tree-parent").hasClass("show")&&e.removeClass("none"),c.append(e)):(e=this.createNode([a]),d.append(e)),d=c.children(".chat-tree-child"),c.children(".chat-tree-parent").children(".chat-total").text(d.children().length))},FriendsPanel.prototype.updateTrees=function(a){var b,c,h,i,j,k,d={},e=0,f=a[0];for(a[1],h=0,i=f.length;i>h;h++)for(b=f[h].children,j=0,k=b.length;k>j;j++)c=this.defaultData(b[j].Name,b[j]),d[c.name]=c,e++;this.trees.data=d,this.updateFTree(a[0]),this.updateOnline(a[1],"online"),this.miniPanel.updateTitle({totalNum:e}),this.jqP.removeClass("hidden")},FriendsPanel.prototype.updateFTree=function(a){var c,b=this.trees.friends;a.length<1&&(a=[{name:x18n.myFriend,children:[]}]),c=$(this.createTree(a,{treeClass:"chat-friends-tree"})),b.last().after(c),b.remove(),this.trees.friends=c,c=null,b=null},FriendsPanel.prototype.updateOnline=function(b,c){var i,j,k,d=this.trees.data,e=this.trees.oData,f=this.trees.oData.indexs,g={},h=[];for(b=b.split(","),j=0,k=b.length;k>j;j++)i=b[j],i&&i in d&&(d[i].online=c,i in f?g[i]=f[i]:h.push(i));g="online"===c?h:g,this.trees.data=d,this.trees.oData=a(e,g),d=null,f=null,this.updateOnlineState(g,c)},FriendsPanel.prototype.updateOnlineState=function(a,b){var g,i,j,k,c=this.trees.online,d=this.trees.recent,e=this.trees.friends,f=this.trees.oData,h=[];switch(b){case"online":c.children(".chat-tree-child").append(this.createNode(a,{online:"online"})),h=a;break;case"offline":g=c.find(".chat-tree-child li");for(i in a)g.eq(a[i]).remove(),h.push(i);g=null}for(this.updateNode(this.getNode(h,d),{online:b}),this.updateNode(this.getNode(h,e),{online:b}),c.children(".chat-tree-parent").children(".chat-num").text(f.length).siblings(".chat-total").text(f.length),d.children(".chat-tree-parent").children(".chat-num").text(d.find(".chat-icon-online").length),e=e.filter(".chat-friends-tree"),j=0,k=e.length;k>j;j++)g=$(e[j]),g.children(".chat-tree-parent").children(".chat-num").text(g.find(".chat-icon-online").length);this.miniPanel.updateTitle({onlineNum:f.length})},FriendsPanel.prototype.updateRecent=function(a){var c,b=this.trees.rData;for(c=b.length-1;c>=0;c--)if(b[c]===a){b.splice(c,1),this.updateRTree(a,"remove");break}b.length>4&&this.updateRTree(b.pop(),"remove"),b.unshift(a),this.updateRTree(a,"prepend")},FriendsPanel.prototype.updateRTree=function(a,b){var e,c=this.trees.recent,d=this.trees.rData;switch(b){case"remove":this.getNode(a,c).remove();break;case"prepend":e=$(this.createNode([a])),c.children(".chat-tree-child").prepend(e)}c.children(".chat-tree-parent").children(".chat-total").text(d.length).siblings(".chat-num").text(c.find(".chat-icon-online").length)},FriendsPanel.prototype.updateOTree=function(a){var d,b=this.trees.online,c=this.trees.oData.length;(arguments.length<1||a.length<1)&&(a=[{name:x18n.onlineFriend,children:this.trees.oData}]),d=$(this.createTree(a,{num:c,treeClass:"chat-online-tree"})),b.after(d).remove(),this.trees.online=d,d=null,b=null},FriendsPanel.prototype.createTree=function(a,b){var d,e,g,h,c=[],f=this.html;for(g=0,h=a.length;h>g;g++)d=a[g],e=d.children?d.children.length:0,c.push(toolLq.htmlTemplate(f.parent[0],$.extend(!0,{title:d.name,num:0,total:e},b),!0)),e>0&&c.push(this.createNode(d.children,b,"all")),c.push(this.html.parent[1]);return c.join("")},FriendsPanel.prototype.createNode=function(a,b,c){var g,h,i,d=this.html,e=this.trees.data,f=[];for("all"===c&&f.push(d.child[0]),h=0,i=a.length;i>h;h++){switch(g=a[h],typeof g){case"string":g=e[g];break;case"object":g=e[g.name]}f.push(toolLq.htmlTemplate(d.child[1],$.extend(!0,{headImg:g.icon,online:g.online,name:g.name},b),!0))}return"all"===c&&f.push(d.child[2]),f.join("")},FriendsPanel.prototype.updateNode=function(a,b){var d,e,f,c=this.html.updateNode;if(("string"==typeof a||a instanceof Array)&&(a=this.getNode(a)),!(a.length<1))for(f in b)if(d=b[f],f in c)$(c[f],a).text(d);else switch(f){case"name":a.attr("data-id",d).attr("title",d);break;case"headImg":$(".chat-user-pic",a).attr("src",d);break;case"online":e="online"===d?"offline":"online",$(["[class*=",e,"]"].join(""),a).each(function(){this.className=this.className.replace(e,d)}),$(["[title=",e,"]"].join(""),a).attr("title",d);break;case"numTran":0==d?$(".chat-num-tran",a).addClass("none"):$(".chat-num-tran",a).removeClass("none").text(d);break;case"numMsg":0==d?$(".chat-num-msg",a).addClass("none"):$(".chat-num-msg",a).removeClass("none").text(d)}},FriendsPanel.prototype.getNode=function(a,b){var e,f,c=a instanceof Array?a:a.split(","),d=[];for((!b||b.length<1)&&(b=this.jqP),e=0,f=c.length;f>e;e++)c[e]&&d.push(["li[data-id=",c[e],"]"].join(""));return b.find(d.join(","))},FriendsPanel.prototype.showSearchTree=function(a){var b,d,f,e=this;if(!$.trim(a))return this.trees.searchRoot.addClass("none"),this.jqP.children(".chat-panel-search").find(".chat-search-key").unbind("keypress.selectOpen"),void 0;b=this.getData(),d=[];for(f in b)f.indexOf(a)>-1&&d.push(f);this.trees.searchRoot.html(this.createNode(d)).removeClass("none").children(":first").addClass("select"),this.jqP.children(".chat-panel-search").find(".chat-search-key").unbind("keypress.selectOpen").on("keypress.selectOpen",{This:e},c)},FriendsPanel.prototype.openMsgWin=function(a){var b=this,c=this.getData(a);return c||(c=this.defaultData(a),this.joinGroup(c,this.stranger)),c.infoOk?(d.call(this,a),void 0):(this.getInfo(a,"language",function(a){var c=b.getData(a);c.infoOk=!0,d.call(b,a),b=null}),void 0)},FriendsPanel.prototype.getInfo=function(a,b,c){var d,e=this;switch(b){case"language":d="203";break;default:return}this.socket.send(["{",'"msgcode":"',d,'"',',"sender":"',IM.config.name,'"',',"receiver":"',a,'"',"}"].join("")),this.onGetInfo=function(b){b===a&&(c.call(e,a),c=null,e.onGetInfo=$.noop,e=null,a=null)}},FriendsPanel.prototype.disable=function(a,b){return b&&!a?(this.jqP.addClass("none"),this.miniPanel.jqP.addClass("none"),void 0):b&&a?(this.jqP.removeClass("none"),this.miniPanel.jqP.removeClass("none"),void 0):a?(a&&this.jqDisable.addClass("none"),void 0):(this.jqDisable.removeClass("none"),void 0)},FriendsPanel.prototype.getTitle=function(a){var c,e,f,b=this.jqTitle,d={};for("string"==typeof a&&(a=a.split(",")),e=0,f=a.length;f>e;e++)switch(c=a[e]){case"name":d[c]=$(".name",b).text();break;case"notice":d[c]=$(".notice",b).html()}return b=null,d},FriendsPanel.prototype.updateTitle=function(a){var c,d,b=this.jqTitle;for(d in a)switch(c=a[d],d){case"name":$(".name",b).text(c);break;case"notice":$(".notice",b).html(c)}},FriendsPanel.prototype.init=function(){var c,d,e,f,g,h,i,a=this,b=this.trees.root=this.jqP.find(".chat-panel-tree");this.jqTitle=this.jqP.children(".chat-panel-title"),this.miniPanel=new MiniPanel(this.jqP.next(".chat-panel-mini")),this.miniPanel.jqP.on("click",".chat-mini-title",function(){a.jqP.removeClass("none"),a.miniPanel.hide()}),this.jqDisable=this.jqP.children(".chat-disable").add(this.miniPanel.jqP.children(".chat-disable")),this.trees.friends=b.children(".chat-friends-tree"),this.trees.online=b.children(".chat-online-tree"),this.trees.recent=b.children(".chat-recent-tree"),this.trees.searchRoot=b.next(".chat-search-tree"),this.trees.searchRoot.on("lq.select","li",function(){}),this.jqP.on("click",".chat-tree-child li",function(b){var f,g,i,j,k,c=$(".chat-user-name",this).html(),d=$(this),e=d.attr("data-id");return $(".chat-win-out").height($(".chat-win").height()-78+"px"),$(".chat-win-main").width($(".chat-win").width()-139+"px"),a.openMsgWin(c),b.stopPropagation(),f=$(".chat-win-talkerList li").length,f>=1?$(".chat-win-talkerList li").each(function(){$(this).attr("data-id"),$(".chat-win-talkerList").find("."+e).remove(),$(".chat-win-talker .chat-win-talkerList").prepend(d.clone().addClass(e))}):$(".chat-win-talker .chat-win-talkerList").prepend(d.clone().addClass(e)),g=$(".chat-win-talker"),$(".chat-win-talkerList"),f=$(".chat-win-talkerList li").length,i=43,j=i*f+60,k=g.height(),j>=k?$(".chat-win-talker .pre,.chat-win-talker .next").css("cursor","pointer"):$(".chat-win-talker .pre,.chat-win-talker .next").css("cursor","default"),$(".chat-win-talkerList li").on("click",function(){var c=$(this).attr("data-id");a.openMsgWin(c),b.stopPropagation()}),!1}).on("click",".chat-tree-parent",function(){var a=$(this);a.hasClass("hide")?(a.addClass("show").removeClass("hide"),a.next("ul").removeClass("none")):(a.addClass("hide").removeClass("show"),a.next("ul").addClass("none")),a=null}).on("click",".chat-flod-btn",function(){a.jqP.addClass("none"),a.miniPanel.show()}).on("input",".chat-search-key",function(){a.showSearchTree(this.value)}),c=$(".chat-win-talkerList"),d=$(".chat-win-out"),e=c.position(),f=e.top,$(".chat-win-talker .next").click(function(){var a=$(".chat-win-talkerList li").length,b=46,e=b*a,g=d.height(),h=e-g;return-h>=f?!1:(f-=43,c.css("top",f+"px"),void 0)}),$(".chat-win-talker .pre").click(function(){return $(".chat-win-talkerList li").length,d.height(),f>=0?!1:(f+=43,c.css("top",f+"px"),void 0)}),this.socket.bind("message",function(b){var c=JSON.parse(b.data);toolLq.log("friendPanel收到消息",c),a.dispose(c)}),this.socket.bind("reconnect",function(){var b=new RegExp("^"+x18n.reconnect,"i"),c=1;return function(){var d=a.getTitle("notice").notice,e=x18n.reconnect;b.test(d)?(d=e+new Array(c++).join("."),c>4&&(c=1)):d=e,a.disable(),a.updateTitle({notice:d})}}()),this.socket.bind("reconnected",function(){a.disable(!0),a.updateTitle({notice:""})}),this.msgWin.model.bind("noReadChange",function(b){var c=b.data;switch(b.type){case"clear":a.updateNode(b.name,{numMsg:0});break;case"pushTran":case"popTran":case"clearTran":a.updateNode(b.name,{numTran:c.length})}}),this.msgWin.model.bind("noReadChange",function(b){var c=b.data,d=a.miniTips,e=b.name;switch(b.type){case"clear":e in d&&a.miniPanel.delTip(d[e]);break;case"insert":if(e in d){a.miniPanel.updateTip({content:[e,"发来",c.length,"条消息"].join("")},d[e]);break}d[e]=a.miniPanel.updateTip({content:[e,"发来",c.length,"条消息"].join(""),clickFn:$.noop})}}),this.msgWin.model.bind("msgChange",function(b){var c=b.name;switch(b.type){case"sendTrans":case"sendMsg":a.updateRecent(c)}}),this.exh+=this.jqP.find(".chat-panel-title").outerHeight()+this.jqP.find(".chat-panel-search").outerHeight()+22,h=0,i=$(window),i.on("resize.im",function(){var c=(new Date).getTime();c-h>200&&(h=c,g=i.height()-a.exh,b.height(g),a.trees.searchRoot.height(g),i.width()<1280?(a.jqP.addClass("none"),a.miniPanel.show()):(a.jqP.removeClass("none"),a.miniPanel.hide()))}),g=i.height()-this.exh,b.height(g),this.trees.searchRoot.height(g),i.width()<1280&&(a.jqP.addClass("none"),a.miniPanel.show())},FriendsPanel.prototype.dispose=function(a){if(a instanceof Array)for(var b=0,c=a.length;c>b;b++)h.call(this,a[b]);else h.call(this,a)}}(),function(){MiniPanel.prototype.updateTitle=function(a){var b,d,c=this.jqP;for(d in a)switch(b=a[d],d){case"onlineNum":$(".chat-num",c).text(b);break;case"totalNum":$(".chat-total",c).text(b)}},MiniPanel.prototype.updateTip=function(a,b){if(!a)return null;var c=this.jqP,d=this.tipStack;return b>=d.length?null:b||0===b?(d[b]=$.extend(!0,d[b],a),b):(d.push(a),$(".chat-num-msg",c).text(d.length).removeClass("none"),d.length-1)},MiniPanel.prototype.delTip=function(a){var b=this.jqP,c=this.tipStack;a||0===a?this.tipStack.splice(a,1):(c=[],this.tipStack=[]),c.length<1?$(".chat-num-msg",b).addClass("none"):$(".chat-num-msg",b).text(c.length)},MiniPanel.prototype.showTip=function(){},MiniPanel.prototype.show=function(){this.jqP.removeClass("none")},MiniPanel.prototype.hide=function(){this.jqP.addClass("none")},MiniPanel.prototype.init=function(){}}(),function(){function b(a){switch(a.msgcode){case"103":alert(a.msgcontent);case"104":this.disable();break;case"601":this.sendCookie()}}var a=new LqEvents;a.url="",a.disabled=!1,a.onConnect=null,a.reconnectTime=0,a.events={message:[],reconnect:[],reconnected:[],disable:[]},a.sendCookie=function(){this.disabled||this.send(['{"msgcode":"600","sender":"',IM.config.name,'","receiver":"',IM.config.language,'","msgcontent":"',IM.config.session,'"}'].join(""))},a.reconnect=function(b){if(!b){try{b=new WebSocket(this.url),a.reconnectTime++,a.reconnectTime>10&&a.disable()}catch(c){}b.onopen=function(){"function"==typeof a.onConnect?(a.onConnect(a),a.onConnect=null):a.trigger("reconnected"),a.send=function(){b.send.apply(b,arguments)}}}toolLq.log("启动socket重连"),b.onmessage=function(b){toolLq.log("socket收到",b),a.trigger("message",b)},b.onerror=function(){},b.onclose=function(c){return toolLq.log("socketClose",c),a.disabled?(b=null,void 0):(a.trigger("reconnect",c),a.reconnect(),a.send=$.noop,b=null,void 0)}},a.disable=function(){var b={};return function(c){return c?(a.disabled=!1,a.reconnect=b.reconnect,void 0):(a.disabled=!0,b.reconnect=a.reconnect,a.reconnect=$.noop,a.trigger("disable"),void 0)}}(),openSocket=function(c,d,e){e=e||{},window.WEB_SOCKET_FORCE_FLASH=!!e.forceFlash,a.url=c,a.onConnect=d,a.bind("message",function(a){var c,d,e;for(toolLq.log("socketProxy收到",a),c=JSON.parse(a.data),d=0,e=c.length;e>d;d++)b.call(this,c[d])}),a.reconnect()}}(),openSocket(IM.config.wsurl,function(a){var b=new MsgControl({model:new MsgModel({socket:a}),getHome:IM.config.getHome,gotoHistory:IM.config.gotoHistory}),c=new FriendsPanel("#chat-box .chat-panel",{fTreeData:[],msgWin:b,socket:a,exh:45});IM.control=b,IM.friendsPanel=c,IM.test=a});