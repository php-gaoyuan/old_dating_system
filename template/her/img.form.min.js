jQuery.extend({createUploadIframe:function(a,c){var b="jUploadFrame"+a,d='<iframe id="'+b+'" name="'+b+'" style="position:absolute; top:-9999px; left:-9999px"';window.ActiveXObject&&("boolean"==typeof c?d+=' src="javascript:false"':"string"==typeof c&&(d+=' src="'+c+'"'));jQuery(d+" />").appendTo(document.body);return jQuery("#"+b).get(0)},createUploadForm:function(a,c,b){var d="jUploadForm"+a,a="jUploadFile"+a,d=jQuery('<form  action="" method="POST" name="'+d+'" id="'+d+'" enctype="multipart/form-data"></form>');
if(b)for(var f in b)jQuery('<input type="hidden" name="'+f+'" value="'+b[f]+'" />').appendTo(d);c=jQuery("#"+c);b=jQuery(c).clone();jQuery(c).attr("id",a);jQuery(c).before(b);jQuery(c).appendTo(d);jQuery(d).css("position","absolute");jQuery(d).css("top","-1200px");jQuery(d).css("left","-1200px");jQuery(d).appendTo("body");return d},ajaxFileUpload:function(a){var a=jQuery.extend({},jQuery.ajaxSettings,a),c=(new Date).getTime(),b=jQuery.createUploadForm(c,a.fileElementId,"undefined"==typeof a.data?
!1:a.data);jQuery.createUploadIframe(c,a.secureuri);var d="jUploadFrame"+c,c="jUploadForm"+c;a.global&&!jQuery.active++&&jQuery.event.trigger("ajaxStart");var f=!1,e={};a.global&&jQuery.event.trigger("ajaxSend",[e,a]);var i=function(c){var g=document.getElementById(d);try{g.contentWindow?(e.responseText=g.contentWindow.document.body?g.contentWindow.document.body.innerHTML:null,e.responseXML=g.contentWindow.document.XMLDocument?g.contentWindow.document.XMLDocument:g.contentWindow.document):g.contentDocument&&
(e.responseText=g.contentDocument.document.body?g.contentDocument.document.body.innerHTML:null,e.responseXML=g.contentDocument.document.XMLDocument?g.contentDocument.document.XMLDocument:g.contentDocument.document)}catch(i){jQuery.handleError(a,e,null,i)}if(e||"timeout"==c){f=!0;var h;try{if(h="timeout"!=c?"success":"error","error"!=h){var j=jQuery.uploadHttpData(e,a.dataType);a.success&&a.success(j,h);a.global&&jQuery.event.trigger("ajaxSuccess",[e,a])}else jQuery.handleError(a,e,h)}catch(k){h="error",
jQuery.handleError(a,e,h,k)}a.global&&jQuery.event.trigger("ajaxComplete",[e,a]);a.global&&!--jQuery.active&&jQuery.event.trigger("ajaxStop");a.complete&&a.complete(e,h);jQuery(g).unbind();setTimeout(function(){try{jQuery(g).remove(),jQuery(b).remove()}catch(c){jQuery.handleError(a,e,null,c)}},100);e=null}};0<a.timeout&&setTimeout(function(){f||i("timeout")},a.timeout);try{b=jQuery("#"+c),jQuery(b).attr("action",a.url),jQuery(b).attr("method","POST"),jQuery(b).attr("target",d),b.encoding?jQuery(b).attr("encoding",
"multipart/form-data"):jQuery(b).attr("enctype","multipart/form-data"),jQuery(b).submit()}catch(j){jQuery.handleError(a,e,null,j)}jQuery("#"+d).load(i);return{abort:function(){}}},handleError:function(a,c,b,d){a.error&&a.error.call(a.context||a,c,b,d);a.global&&(a.context?jQuery(a.context):jQuery.event).trigger("ajaxError",[c,a,d])},uploadHttpData:function(a,c){var b;b="xml"==c||!c?a.responseXML:a.responseText;"script"==c&&jQuery.globalEval(b);"json"==c&&eval("data = '"+b+"'");"html"==c&&jQuery("<div>").html(b).evalScripts();
return b}});
var isIE = document.all ? !0 : !1, isIE6=isIE&&6!=window.XMLHttpRequest, $id = function (a) { return "string" == typeof a ? document.getElementById(a) : a }, Class = { create: function () { return function () { this.initialize.apply(this, arguments) } } }, Extend = function (a, c) { for (var b in c) a[b] = c[b] }, Bind = function (a, c) { return function () { return c.apply(a, arguments) } }, BindAsEventListener = function (a, c) { var b = Array.prototype.slice.call(arguments).slice(2); return function (d) { return c.apply(a, [d || window.event].concat(b)) } }, CurrentStyle =
function(a){return a.currentStyle||document.defaultView.getComputedStyle(a,null)};function addEventHandler(a,c,b){a.addEventListener?a.addEventListener(c,b,!1):a.attachEvent?a.attachEvent("on"+c,b):a["on"+c]=b}function removeEventHandler(a,c,b){a.removeEventListener?a.removeEventListener(c,b,!1):a.detachEvent?a.detachEvent("on"+c,b):a["on"+c]=null}var ImgCropper=Class.create();
ImgCropper.prototype={initialize:function(a,c,b,d){this._Container=$id(a);this._layHandle=$id(c);this.Url=b;this._layBase=this._Container.appendChild(document.createElement("img"));this._layCropper=this._Container.appendChild(document.createElement("img"));this._layCropper.onload=Bind(this,this.SetPos);this._tempImg=document.createElement("img");this._tempImg.onload=Bind(this,this.SetSize);this.SetOptions(d);this.Opacity=Math.round(this.options.Opacity);this.Color=this.options.Color;this.Scale=!!this.options.Scale;
this.Ratio=Math.max(this.options.Ratio,0);this.Width=Math.round(this.options.Width);this.Height=Math.round(this.options.Height);this._drag=new Drag(this._layHandle,{Limit:!0,onMove:Bind(this,this.SetPos),Transparent:!0});if(this.Resize=!!this.options.Resize)a=this.options,c=new Resize(this._layHandle,{Max:!0,onResize:Bind(this,this.SetPos)}),a.RightDown&&c.Set(a.RightDown,"right-down"),a.LeftDown&&c.Set(a.LeftDown,"left-down"),a.RightUp&&c.Set(a.RightUp,"right-up"),a.LeftUp&&c.Set(a.LeftUp,"left-up"),
a.Right&&c.Set(a.Right,"right"),a.Left&&c.Set(a.Left,"left"),a.Down&&c.Set(a.Down,"down"),a.Up&&c.Set(a.Up,"up"),this.Min=!!this.options.Min,this.minWidth=Math.round(this.options.minWidth),this.minHeight=Math.round(this.options.minHeight),this._resize=c;this._Container.style.position="relative";this._Container.style.overflow="hidden";this._layHandle.style.zIndex=200;this._layCropper.style.zIndex=100;this._layBase.style.position=this._layCropper.style.position="absolute";this._layBase.style.top=this._layBase.style.left=
this._layCropper.style.top=this._layCropper.style.left=0;this.Init()},SetOptions:function(a){this.options={Opacity:50,Color:"",Width:0,Height:0,Resize:!1,Right:"",Left:"",Up:"",Down:"",RightDown:"",LeftDown:"",RightUp:"",LeftUp:"",Min:!1,minWidth:50,minHeight:50,Scale:!1,Ratio:0,Preview:"",viewWidth:0,viewHeight:0};Extend(this.options,a||{})},Init:function(){this.Color&&(this._Container.style.backgroundColor=this.Color);this._tempImg.src=this._layBase.src=this._layCropper.src=this.Url;if(isIE){this._layBase.style.filter=
"alpha(opacity:"+this.Opacity+")";this._layBase.style.opacity=this.Opacity/100;}else{this._layBase.style.opacity=this.Opacity/100;}if(this.Resize)with(this._resize)Scale=this.Scale,Ratio=this.Ratio,Min=this.Min,minWidth=this.minWidth,minHeight=this.minHeight},SetPos:function(){if(isIE6)with(this._layHandle.style)zoom=0.9,zoom=1;var a=this.GetPos();this._layCropper.style.clip="rect("+a.Top+"px "+(a.Left+a.Width)+"px "+(a.Top+a.Height)+"px "+a.Left+"px)"},SetSize:function(){var a=this.GetSize(this._tempImg.width,this._tempImg.height,this.Width,this.Height);
this._layBase.style.width=this._layCropper.style.width=this._Container.style.width=a.Width+"px";this._layBase.style.height=this._layCropper.style.height=this._Container.style.height=a.Height+"px";this._drag.mxRight=a.Width;this._drag.mxBottom=a.Height;this.Resize&&(this._resize.mxRight=a.Width,this._resize.mxBottom=a.Height);this.Width=a.Width;this.Height=a.Height},GetPos:function(){with(this._layHandle)return{Top:offsetTop,Left:offsetLeft,Width:offsetWidth,Height:offsetHeight}},GetSize:function(a,
c,b,d){var f=a/c;d&&(a=(c=d)*f);if(b&&(!d||a>b))c=(a=b)/f;return{Width:a,Height:c}},GetRatio:function(){return this.Height/this._tempImg.height}};var Drag=Class.create();
Drag.prototype={initialize:function(a,c){this.Drag=$id(a);this._marginLeft=this._marginTop=this._x=this._y=0;this._fM=BindAsEventListener(this,this.Move);this._fS=Bind(this,this.Stop);this.SetOptions(c);this.Limit=!!this.options.Limit;this.mxLeft=parseInt(this.options.mxLeft);this.mxRight=parseInt(this.options.mxRight);this.mxTop=parseInt(this.options.mxTop);this.mxBottom=parseInt(this.options.mxBottom);this.LockX=!!this.options.LockX;this.LockY=!!this.options.LockY;this.Lock=!!this.options.Lock;
this.onStart = this.options.onStart; this.onMove = this.options.onMove; this.onStop = this.options.onStop; this._Handle = $id(this.options.Handle) || this.Drag; this._mxContainer = $id(this.options.mxContainer) || null;this.Drag.style.position="absolute";if(isIE&&this.options.Transparent)with(this._Handle.appendChild(document.createElement("div")).style)width=height="100%",backgroundColor="#fff",filter="alpha(opacity:0)",opacity=0,fontSize = 0; this.Repair(); addEventHandler(this._Handle, "mousedown", BindAsEventListener(this, this.Start))
},
SetOptions:function(a){this.options={Handle:"",Limit:!1,mxLeft:0,mxRight:9999,mxTop:0,mxBottom:9999,mxContainer:"",LockX:!1,LockY:!1,Lock:!1,Transparent:!1,onStart:function(){},onMove:function(){},onStop:function(){}};Extend(this.options,a||{})},Start:function(a){this.Lock||(this.Repair(),this._x=a.clientX-this.Drag.offsetLeft,this._y=a.clientY-this.Drag.offsetTop,this._marginLeft=parseInt(CurrentStyle(this.Drag).marginLeft)||0,this._marginTop=parseInt(CurrentStyle(this.Drag).marginTop)||0,addEventHandler(document,
"mousemove",this._fM),addEventHandler(document,"mouseup",this._fS),isIE?(addEventHandler(this._Handle,"losecapture",this._fS),this._Handle.setCapture()):(addEventHandler(window,"blur",this._fS),a.preventDefault()),this.onStart())},Repair:function(){this.Limit&&(this.mxRight=Math.max(this.mxRight,this.mxLeft+this.Drag.offsetWidth),this.mxBottom=Math.max(this.mxBottom,this.mxTop+this.Drag.offsetHeight),!this._mxContainer||"relative"==CurrentStyle(this._mxContainer).position||"absolute"==CurrentStyle(this._mxContainer).position||
(this._mxContainer.style.position="relative"))},Move:function(a){if(this.Lock)this.Stop();else{window.getSelection?window.getSelection().removeAllRanges():document.selection.empty();var c=a.clientX-this._x,a=a.clientY-this._y;if(this.Limit){var b=this.mxLeft,d=this.mxRight,f=this.mxTop,e=this.mxBottom;this._mxContainer&&(b=Math.max(b,0),f=Math.max(f,0),d=Math.min(d,this._mxContainer.clientWidth),e=Math.min(e,this._mxContainer.clientHeight));c=Math.max(Math.min(c,d-this.Drag.offsetWidth),b);a=Math.max(Math.min(a,
e-this.Drag.offsetHeight),f)}this.LockX||(this.Drag.style.left=c-this._marginLeft+"px");this.LockY||(this.Drag.style.top=a-this._marginTop+"px");this.onMove()}},Stop:function(){removeEventHandler(document,"mousemove",this._fM);removeEventHandler(document,"mouseup",this._fS);isIE?(removeEventHandler(this._Handle,"losecapture",this._fS),this._Handle.releaseCapture()):removeEventHandler(window,"blur",this._fS);this.onStop()}};var Resize=Class.create();
Resize.prototype={initialize:function(a,c){this._obj=$id(a);this._scaleLeft=this._scaleTop=this._fixLeft=this._fixTop=this._sideRight=this._sideDown=this._sideLeft=this._sideUp=this._styleWidth=this._styleHeight=this._styleLeft=this._styleTop=0;this._mxSet=function(){};this._mxScaleWidth=this._mxScaleHeight=this._mxRightWidth=this._mxDownHeight=this._mxUpHeight=this._mxLeftWidth=0;this._fun=function(){};var b=CurrentStyle(this._obj);this._borderX=(parseInt(b.borderLeftWidth)||0)+(parseInt(b.borderRightWidth)||
0);this._borderY=(parseInt(b.borderTopWidth)||0)+(parseInt(b.borderBottomWidth)||0);this._fR=BindAsEventListener(this,this.Resize);this._fS=Bind(this,this.Stop);this.SetOptions(c);this.Max=!!this.options.Max;this._mxContainer=$id(this.options.mxContainer)||null;this.mxLeft=Math.round(this.options.mxLeft);this.mxRight=Math.round(this.options.mxRight);this.mxTop=Math.round(this.options.mxTop);this.mxBottom=Math.round(this.options.mxBottom);this.Min=!!this.options.Min;this.minWidth=Math.round(this.options.minWidth);
this.minHeight=Math.round(this.options.minHeight);this.Scale=!!this.options.Scale;this.Ratio=Math.max(this.options.Ratio,0);this.onResize=this.options.onResize;this._obj.style.position="absolute";!this._mxContainer||"relative"==CurrentStyle(this._mxContainer).position||(this._mxContainer.style.position="relative")},SetOptions:function(a){this.options={Max:!1,mxContainer:"",mxLeft:0,mxRight:9999,mxTop:0,mxBottom:9999,Min:!1,minWidth:50,minHeight:50,Scale:!1,Ratio:0,onResize:function(){}};Extend(this.options,
a||{})},Set:function(a,c){var a=$id(a),b;if(a){switch(c.toLowerCase()){case "up":b=this.Up;break;case "down":b=this.Down;break;case "left":b=this.Left;break;case "right":b=this.Right;break;case "left-up":b=this.LeftUp;break;case "right-up":b=this.RightUp;break;case "left-down":b=this.LeftDown;break;default:b=this.RightDown}addEventHandler(a,"mousedown",BindAsEventListener(this,this.Start,b))}},Start:function(a,c){a.stopPropagation?a.stopPropagation():a.cancelBubble=!0;this._fun=c;this._styleWidth=
this._obj.clientWidth;this._styleHeight=this._obj.clientHeight;this._styleLeft=this._obj.offsetLeft;this._styleTop=this._obj.offsetTop;this._sideLeft=a.clientX-this._styleWidth;this._sideRight=a.clientX+this._styleWidth;this._sideUp=a.clientY-this._styleHeight;this._sideDown=a.clientY+this._styleHeight;this._fixLeft=this._styleLeft+this._styleWidth;this._fixTop=this._styleTop+this._styleHeight;this.Scale&&(this.Ratio=Math.max(this.Ratio,0)||this._styleWidth/this._styleHeight,this._scaleLeft=this._styleLeft+
this._styleWidth/2,this._scaleTop=this._styleTop+this._styleHeight/2);if(this.Max){var b=this.mxLeft,d=this.mxRight,f=this.mxTop,e=this.mxBottom;this._mxContainer&&(b=Math.max(b,0),f=Math.max(f,0),d=Math.min(d,this._mxContainer.clientWidth),e=Math.min(e,this._mxContainer.clientHeight));d=Math.max(d,b+(this.Min?this.minWidth:0)+this._borderX);e=Math.max(e,f+(this.Min?this.minHeight:0)+this._borderY);this._mxSet=function(){this._mxRightWidth=d-this._styleLeft-this._borderX;this._mxDownHeight=e-this._styleTop-
this._borderY;this._mxUpHeight=Math.max(this._fixTop-f,this.Min?this.minHeight:0);this._mxLeftWidth=Math.max(this._fixLeft-b,this.Min?this.minWidth:0)};this._mxSet();this.Scale&&(this._mxScaleWidth=2*Math.min(this._scaleLeft-b,d-this._scaleLeft-this._borderX),this._mxScaleHeight=2*Math.min(this._scaleTop-f,e-this._scaleTop-this._borderY))}addEventHandler(document,"mousemove",this._fR);addEventHandler(document,"mouseup",this._fS);isIE?(addEventHandler(this._obj,"losecapture",this._fS),this._obj.setCapture()):
(addEventHandler(window,"blur",this._fS),a.preventDefault())},Resize:function(a){window.getSelection?window.getSelection().removeAllRanges():document.selection.empty();this._fun(a);with(this._obj.style)width=this._styleWidth+"px",height=this._styleHeight+"px",top=this._styleTop+"px",left=this._styleLeft+"px";this.onResize()},Up:function(a){this.RepairY(this._sideDown-a.clientY,this._mxUpHeight);this.RepairTop();this.TurnDown(this.Down)},Down:function(a){this.RepairY(a.clientY-this._sideUp,this._mxDownHeight);
this.TurnUp(this.Up)},Right:function(a){this.RepairX(a.clientX-this._sideLeft,this._mxRightWidth);this.TurnLeft(this.Left)},Left:function(a){this.RepairX(this._sideRight-a.clientX,this._mxLeftWidth);this.RepairLeft();this.TurnRight(this.Right)},RightDown:function(a){this.RepairAngle(a.clientX-this._sideLeft,this._mxRightWidth,a.clientY-this._sideUp,this._mxDownHeight);this.TurnLeft(this.LeftDown)||this.Scale||this.TurnUp(this.RightUp)},RightUp:function(a){this.RepairAngle(a.clientX-this._sideLeft,
this._mxRightWidth,this._sideDown-a.clientY,this._mxUpHeight);this.RepairTop();this.TurnLeft(this.LeftUp)||this.Scale||this.TurnDown(this.RightDown)},LeftDown:function(a){this.RepairAngle(this._sideRight-a.clientX,this._mxLeftWidth,a.clientY-this._sideUp,this._mxDownHeight);this.RepairLeft();this.TurnRight(this.RightDown)||this.Scale||this.TurnUp(this.LeftUp)},LeftUp:function(a){this.RepairAngle(this._sideRight-a.clientX,this._mxLeftWidth,this._sideDown-a.clientY,this._mxUpHeight);this.RepairTop();
this.RepairLeft();this.TurnRight(this.RightUp)||this.Scale||this.TurnDown(this.LeftDown)},RepairX:function(a,c){a=this.RepairWidth(a,c);if(this.Scale){var b=this.RepairScaleHeight(a);if(this.Max&&b>this._mxScaleHeight)b=this._mxScaleHeight,a=this.RepairScaleWidth(b);else if(this.Min&&b<this.minHeight){var d=this.RepairScaleWidth(this.minHeight);d<c&&(b=this.minHeight,a=d)}this._styleHeight=b;this._styleTop=this._scaleTop-b/2}this._styleWidth=a},RepairY:function(a,c){a=this.RepairHeight(a,c);if(this.Scale){var b=
this.RepairScaleWidth(a);if(this.Max&&b>this._mxScaleWidth)b=this._mxScaleWidth,a=this.RepairScaleHeight(b);else if(this.Min&&b<this.minWidth){var d=this.RepairScaleHeight(this.minWidth);d<c&&(b=this.minWidth,a=d)}this._styleWidth=b;this._styleLeft=this._scaleLeft-b/2}this._styleHeight=a},RepairAngle:function(a,c,b,d){a=this.RepairWidth(a,c);this.Scale?(b=this.RepairScaleHeight(a),this.Max&&b>d?(b=d,a=this.RepairScaleWidth(b)):this.Min&&b<this.minHeight&&(d=this.RepairScaleWidth(this.minHeight),d<
c&&(b=this.minHeight,a=d))):b=this.RepairHeight(b,d);this._styleWidth=a;this._styleHeight=b},RepairTop:function(){this._styleTop=this._fixTop-this._styleHeight},RepairLeft:function(){this._styleLeft=this._fixLeft-this._styleWidth},RepairHeight:function(a,c){a=Math.min(this.Max?c:a,a);return a=Math.max(this.Min?this.minHeight:a,a,0)},RepairWidth:function(a,c){a=Math.min(this.Max?c:a,a);return a=Math.max(this.Min?this.minWidth:a,a,0)},RepairScaleHeight:function(a){return Math.max(Math.round((a+this._borderX)/
this.Ratio-this._borderY),0)},RepairScaleWidth:function(a){return Math.max(Math.round((a+this._borderY)*this.Ratio-this._borderX),0)},TurnRight:function(a){if(!this.Min&&!this._styleWidth)return this._fun=a,this._sideLeft=this._sideRight,this.Max&&this._mxSet(),!0},TurnLeft:function(a){if(!this.Min&&!this._styleWidth)return this._fun=a,this._sideRight=this._sideLeft,this._fixLeft=this._styleLeft,this.Max&&this._mxSet(),!0},TurnUp:function(a){if(!this.Min&&!this._styleHeight)return this._fun=a,this._sideDown=
this._sideUp,this._fixTop=this._styleTop,this.Max&&this._mxSet(),!0},TurnDown:function(a){if(!this.Min&&!this._styleHeight)return this._fun=a,this._sideUp=this._sideDown,this.Max&&this._mxSet(),!0},Stop:function(){removeEventHandler(document,"mousemove",this._fR);removeEventHandler(document,"mouseup",this._fS);isIE?(removeEventHandler(this._obj,"losecapture",this._fS),this._obj.releaseCapture()):removeEventHandler(window,"blur",this._fS)}};
